---
title: "Assignment_1"
format: html
editor: visual
bibliography: MSB104.bib
---

```{r}
#| label: setup
#| echo: false
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(magrittr)
library(knitr)
library(dineq)
library(ineq)
library(ggplot2)
library(scales)
library(cowplot)
library(dplyr)
library(huxtable)
library(vtable)
library(future)
library(furrr)
library(lmtest)
```

# Assignment 1: Data and Descriptive

This assignment aims to obtain, process, and analyze sub-national GDP and population data for a subset of European countries.
The selected subset comprises the Czech Republic, Turkey, Finland and the United Kingdom.
The objective is to calculate GDP per capita and explore regional inequity using a range of descriptive statistics and visualizations.

## Part A: Sub-national GDP and GDP per Capita

In the first part, we will dive into sub-national GDP for the selected European countries.
Firstly, a brief overview of the data acquisition will be given.
Furthermore, we will calculate GDP per capita for each sub-region.
Lastly, we will provide a descriptive analysis that gives insights into the distribution and the central tendencies of the data.

### Data Acquisition

The assignment is based on datasets providing sub-regional data on GDP and population from the year 2000 to 2020.
We had to obtain data for the UK in a different way than for the rest of the countries.
We will now take you through the data acquisition.

We obtained data for the EU countries (Czech Republic, Turkey and Finland) from Eurostat.
We downloaded two datasets, one providing GDP data and the other one providing population data.
The NUTS classification is a hierarchical system that enables cross-border statistical comparisons at various regional levels within the EU.
The datasets we downloaded from Eurostat are at a NUTS 3 level.

```{r}
# GDP data for Czech Republic, Turkey and Finland
gdp_data <- read_csv("nama_10r_3gdp__custom_7667248_linear.csv") |>
  filter(unit == "MIO_EUR") |>
  select(year = TIME_PERIOD, geo, gdp = OBS_VALUE)
```

```{r}
# Population data for Czech Republic, Turkey and Finland
population_data <- read_csv("demo_r_pjanaggr3__custom_7667383_linear.csv") |>
  select(year = TIME_PERIOD, geo, pop = OBS_VALUE)
```

The UK is not included in the datasets from Eurostat, since the country is no longer a part of the EU.
We got sub-regional GDP and population data for the UK from the Office for National Statistics.
The UK uses another classification system than the EU.
Instead of NUTS regions, they use ITL regions.
These two classification systems work on the same principle and we will from now on, refer to all regions as NUTS.

```{r}
# GDP data for UK
gdp_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 5", skip = 1)
```

```{r}
# Population data for UK
population_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 6", skip = 1)
```

```{r}
# Reforming gdp_UK
gdp_UK <- gdp_UK %>%
  gather(year, gdp, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, gdp) %>%
  arrange(geo)
```

```{r}
# Reforming population_UK
population_UK <- population_UK %>%
  gather(year, pop, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, pop) %>%
  arrange(geo)
```

When sub-regional GDP and population data for both the EU countries and the UK were downloaded, we merged the EU datasets with the UK datasets to get one main dataset containing sub-regional GDP and population for all the countries.
We named the final dataset for "main_data".

```{r}
# Merging gdp dataset with population dataset for the EU countries
merged_data <- gdp_data |>
  left_join(population_data, join_by(year,geo))
```

```{r}
# Merging gdp dataset with population dataset for the UK
merged_UK <- gdp_UK |>
  left_join(population_UK, join_by(year,geo))
merged_UK$geo <- gsub("TL", "UK", merged_UK$geo)
```

```{r}
# Converting the "year" variable into a character
merged_data$year <- as.character(merged_data$year)
merged_UK$year <- as.character(merged_UK$year)
```

```{r}
# Merging EU dataset with UK dataset
main_data <- full_join(merged_data, merged_UK)
```

```{r}
# We only want data from year 2000 to 2020
main_data <- main_data %>%
  subset(main_data$year >= 2000 & main_data$year <= 2020) %>%
  select(year, geo, pop, gdp)
```

```{r}
# Clean up
rm(gdp_data, population_data, gdp_UK, population_UK, merged_data, merged_UK)
```

### GDP per Capita Calculation

The GDP per capita gives an average representation of the economic well-being of the individuals in the regions, indicating the amount of economic output generated, by each person.

We add a new variable measuring GDP per capita to our main dataset by using the formula:

$y_{i} = \frac{GDP_{i}}{Population_{i}}$

```{r}
# Adding GDP per capita in the main_data
main_data <- main_data %>%
  mutate(gdp_per_capita = gdp / pop)
```

### Descriptive Analysis

Our dataset includes GDP measured at current market prices in millions of euros for Czech Republic, Turkey, and Finland.
For the United Kingdom, GDP is measured in millions of pounds.
The population variable represents the total annual population within each NUTS 3 region.
Consequently, the GDP per capita variable expresses GDP in millions of euros/pounds per capita in each NUTS 3 region.

Through descriptive statistic we will summarize and describe the main features and key characteristics of the dataset.
We will present a summary of the descriptive statistics for each country.
The summary contains minimum and maximum value, median, mean, quartiles, variance and standard deviation for gdp, population and gdp per capita.

```{r}
# Create subsets for each country 
data_CZ <- subset(main_data, grepl("^CZ", geo))
data_TR <- subset(main_data, grepl("^TR", geo))
data_FI <- subset(main_data, grepl("^FI", geo))
data_UK <- subset(main_data, grepl("^UK", geo))

# Generate summary statistics for each country
summary_CZ <- summary(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))])
summary_TR <- summary(data_TR[, !(names(data_TR) %in% c("year", "geo"))])
summary_FI <- summary(data_FI[, !(names(data_FI) %in% c("year", "geo"))])
summary_UK <- summary(data_UK[, !(names(data_UK) %in% c("year", "geo"))])

# Calculate variance and standard deviation for each country (excluding NA values)
var_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], sd, na.rm = TRUE)

# Add variance and standard deviation to the summary statistics
summary_CZ <- rbind(summary_CZ, var = var_CZ, sd = sd_CZ)
summary_TR <- rbind(summary_TR, var = var_TR, sd = sd_TR)
summary_FI <- rbind(summary_FI, var = var_FI, sd = sd_FI)
summary_UK <- rbind(summary_UK, var = var_UK, sd = sd_UK)

# Create summary tables for each country
kable(summary_CZ, caption = "Table 1: Summary Statistics for Czech Republic (CZ)")
kable(summary_TR, caption = "Table 2: Summary Statistics for Turkey (TR)")
kable(summary_FI, caption = "Table 3: Summary Statistics for Finland (FI)")
kable(summary_UK, caption = "Table 4: Summary Statistics for United Kingdom (UK)")
```

The Czech Republic's (CZ) regional GDP ranges from a minimum value of 1702 million Euros to a maximum value of 61602 million Euros.
The mean GDP is 10291 million Euros and the standard deviation 9504.78 million euros.
This indicates a moderate overall economic output for the country.
The mean of the population in the NUTS 3 regions within Czech Republic is 748,180 people, with a standard deviation of 320,076.68.
The average GDP per capita is 0.0130 million euros, indicating a moderate level of economic well-being on average among the regions.
The range of GDP per capita in the Czech Republic is from 0.005030 million euros to 0.047073 million euros.
This signifies the variability in the standard of living among the regions.
The standard deviation is 0.006364, confirming some spread in the GDP per capita among the regions.
However, there are 11 missing values, which might impact the accuracy of the analysis.

Turkey (TR) has a wide range in GDP, reflecting a significant economic diversity between the regions.
GDP varies from a minimum value of 196.8 million Euros to a maximum value of 242,730.0 million Euros, with a mean of 7421 million euros.
The standard variation is large, 21841 million euros.
The median value (2513.5) is lower than the mean, which may indicate that the high maximum GDP might be influenced by outliers.
The population in Turkey varies from 74,412 to 15,067,724 people, indicating a wide spectrum among the regions.
The GDP per capita in Turkey varies widely ranging from a minimum of 0.001581 million euros to a maximum of 0.016721 million euros, with a relatively low mean of 0.0061 million euros.
The standard deviation of 0.002523 million euros is notable, indicating substantial variability in the economic well-being between regions in Turkey.

Finland (FI) have a relatively high regional GDP mean of 9419.13 million euros, with a standard deviation of 15210.64 million euros.
The regions have a population ranging from 25706 to 1671024 people.
Finland have regions with relatively small in population size.
The mean GDP per capita is 0.0312 million euros, reflecting a relatively high average standard of living.
Finland's GDP per capita is notably higher than the other countries, suggesting a high standard of living.
The low standard deviation (0.00708) indicate that, on average, the GDP per capita values do not deviate significantly from the mean.
It is important to note that the country has 20 missing values.

The United Kingdom (UK) mean GDP of 9130 million pounds, suggests a robust overall economic output in the regions.
The minimum value is 320 million ponds and the maximum value is 117,051 million ponds.
The UK have the highest GDP range among the four countries, indicating a large and varied economy.
The population size of the regions varies from 19,220 to 1,195,672 people.
The UK exhibits the highest mean GDP per capita among the studied countries, standing at 0.0261 million pounds.
The standard deviation of 0.0286 indicates a moderate level of variability in GDP per capita.
There might be some significant outliers, as suggested bu the large difference between the maximum value (0.413616) and the 3rd quartile (0.026761).

We will give a short summary of the GDP per capita for the regions within the four countries, because GDP per capita accounts for differences arising from regions of varying sizes.
The United Kingdom stands out with the highest maximum GDP per capita, indicating some regions with very high economic output.
The UK also exhibits the widest range of GDP per capita among regions.
Finland follows the UK with a relatively high overall economic well-being.
The distribution suggest that the standard of living is generally favourable across regions.
The Czech Republic falls in the middle, with a moderate range of GDP per capita, suggesting different levels of economic well-being across regions.
Turkey has the lowest range of GDP per capita.
There is less variation among the regions in Turkey, compared to the other countries.
Turkey have the lowest economic well-being on a person basis.

## Part B: Regional Inequity

The second part focuses on regional inequality.
We will start with a literate review of the subject, then compute population-weighted GDP Gini coefficients for the NUTS 2 regions within our subset of European countries.
This includes data presentation through descriptive statistics and visuals.
In the end, we will discuss the computed Gini coefficients and reflect on the implications of our findings in the context of regional inequity.

### Literature Review

Regional inequality refers to the disparities in economic development, income, and other socio-economic indicators among different geographical regions within a country or across countries.
According to @lessmann2017, regional inequality within countries has attracted considerable interest among academics and policy makers in the last decades.
Research on regional inequality is particularly important for the economy.
When certain regions experience higher levels of economic development and prosperity compared to others, it can have far-reaching consequences.
However, in general are the empirical studies on regional inequality limited to a specific country sample with a general bias towards medium and high income economies.
The biggest challenge is obtaining data from the less developed regions in the world.
The poorest regions appear as blank spots on the map.
@lessmann2017 fill this gap by predicting regional incomes using night light data.
Further, they calculated inequality measures, for example population-weighted Gini coefficient, based on these predicted incomes.

We should care about regional inequality because it is essential for both the economy and social welfare in general.
The potential consequences of regional inequality are many.
@lessmann2017 highlights a correlation between regional inequality and personal income inequality, ethnic inequality, and political stability in their study.
Addressing regional imbalances within countries is crucial, as they may independently contribute to economic outcomes and exacerbate issues like income inequality, ethnic tensions, and segregation.

### Gini Coefficient Calculation

Measuring regional inequality is challenging because it is difficult to compare regions of different sizes.
To deal with this issue, we can use a population-weighted Gini coefficient that accounts for different sizes of the regions [@lessmann2017] .

We wanted to compute the population-weighted Gini coefficient for the NUTS 2 level regions in the Czech Republic, Turkey, Finland and the UK.
We created a new dataset containing the NUTS 2 regions and added a variable measuring the population-weighted GDP Gini coefficient for each NUTS 2 region by using the formula:

$GINW_j=\frac{1}{2\overline y j} \sum_{i}^{n_j} \sum_{l}^{n_j} \frac{p_i}{P_j} \frac{p_l}{P_j} |y_i - y_l|$

```{r}
# Creating a NUTS 0, NUTS 2 and NUTS 3 level
main_data_nuts2 <- main_data |>
  mutate(id_nuts3 = geo,
         id_nuts2 = substr(geo, 1,4),
         id_nuts0 = substr(geo, 1, 2)
         )
```

```{r}
main_data_nuts2 <- main_data_nuts2 |>
  # Removing NA`s 
  filter(pop != "NA") |>
  filter(pop != 0) |>
  filter(gdp_per_capita != "NA") |>
  group_by(id_nuts2, year) |>
  # Adding Gini coefficient, population, GDP and GDP per capita for the NUTS 2 regions
  mutate(gini_n2 = gini.wtd(gdp_per_capita, weights = pop), 
         pop_n2 = sum(pop),
         gdp_n2 = mean(gdp),
         gdp_per_capita_n2 = mean(gdp_per_capita)
         ) |>
  ungroup()
```

```{r}
# Selecting only the NUTS 2 variables
main_data_nuts2 <- main_data_nuts2 %>%
   select(year, -geo, -gdp, -pop, -gdp_per_capita, -id_nuts3, id_nuts0, id_nuts2, pop_n2, gdp_n2, gdp_per_capita_n2, gini_n2)
```

```{r}
# Selecting only the first row of each group 
main_data_nuts2 <- main_data_nuts2 |>
 group_by(id_nuts2, year) |>
  slice(1) 
```

### Data Presentation

We created a table to get a overview of the population-weighted GDP Gini coefficient for each country (NUTS 0 regions).

```{r}
# Calculating Gini Coefficient at a NUTS 0 level
gini_nuts0 <- main_data_nuts2 |>
  filter(!is.na(gini_n2)) |>
  group_by(id_nuts0) |>
  summarize(
    Mean = mean(gini_n2),
    Variance = var(gini_n2),
    Max = max(gini_n2),
    Min = min(gini_n2)
  ) 
```

```{r}
# Table
gini_nuts0 |>
  kable(caption = "Table 5: Gini Coefficient for the countries")
```

From the table we see that the Czech Republic exhibits relatively low regional inequality.
It has a mean of 0.0131, indicating lowest regional inequality on average among the countries.
The data has low variance (0.0002), suggesting a relatively stable distribution.
The maximum Gini coefficient observed is 0.0353, while the minimum is 0.
This indicates a fairly equitable income distribution within the country.

Finland follows with slightly higher mean and maximum value.
The Gini coefficient has a higher mean value of 0.0282, indicating slightly more regional inequality compared to the Czech Republic.
The variance is also higher (0.0006), suggesting more variability in income distribution.
The maximum Gini coefficient observed is 0.0708, and the minimum is 0.
Finland's income distribution is relatively equitable but slightly more diverse than that of the Czech Republic.

Turkey displays a higher level of regional inequality, with a mean Gini coefficient of 0.0544.
The data exhibits greater variance (0.0015), indicating significant income disparities.
The maximum Gini coefficient observed is 0.1642, emphasizing the presence of considerable regional inequality within the country.
However, the minimum is 0, highlighting the absence of perfectregional equality.

The United Kingdom experiences the highest regional inequality among the studied countries, with a mean Gini coefficient of 0.0917.
The variance is substantial (0.0067), signifying a wide range of income disparities.
The maximum Gini coefficient observed is 0.4925, while there is no recorded minimum (0).
The UK's income distribution is characterized by a significant degree of inequality.

#### Subset 2018 from main_data_nuts2:

We chose to look further at data from year 2018.
Within this subset, we focused on NUTS2 regions in the four countries: Czechia, Turkey, the United Kingdom (UK), and Finland.
Our aim was to explore potential trends in regional inequality, as measured by the Gini coefficient, in relation to the population of these NUTS2 regions.

```{r}
subset_nuts2data <- main_data_nuts2 %>%
  filter(grepl("2018", year))
```

To visualize these trends more effectively for each region, we employed a scatterplot.
In this plot, we assigned different colors to represent the Gini coefficients of each region.
This allowed us to examine and compare how regional inequality may vary concerning population size for each of the mentioned countries.

To create these visualizations, we utilized the ggplot2 library in R, enabling us to analyze and depict the data effectively.

```{r}
# Create the scatterplot
scatter_plot <- ggplot(subset_nuts2data, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")
  
# Add the regression line
scatter_plot <- scatter_plot +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black")

scatter_plot
```

We opted to exclude a specific NUTS2 region within the UK, located in London, due to its unusually high level of inequality, which deviated significantly from the patterns observed in other regions.
This decision was made to ensure a more accurate and representative analysis.
Additionally, we omitted Istanbul from the dataset, primarily because it is significantly larger than any other city in the dataset, and its unique characteristics could potentially skew the overall analysis:\

```{r}
# Create the scatterplot
scatter_plot2 <- ggplot(subset_nuts2data, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region") +
  scale_x_continuous(limits = c(0, 6000000)) +
  scale_y_continuous(limits = c(0, 0.3))  # Set the y-axis limits to 0.3

# Add the regression line
scatter_plot2 <- scatter_plot2 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )

scatter_plot2
```

#### Subset UK from nuts2:

We also created a subset of the 'main_data_nuts2' specifically for the United Kingdom (UK) due to its extensive dataset.
Our objective was to closely examine whether the trend in the Gini coefficient was consistent within the UK, as it was for all the NUTS2 regions across various countries.

```{r}
subset_nuts2data_UK <- main_data_nuts2 %>%
  filter(grepl("^UK", id_nuts2) & year == 2018)
```

To achieve this, we generated a new scatterplot using the 'ggplot()' function.

```{r}
# Create the scatterplot
scatter_plot3 <- ggplot(subset_nuts2data_UK, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")  
# Add the regression line
scatter_plot3 <- scatter_plot3 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )
  
scatter_plot3

```

### Discussion

**Economic Performance and GDP per Capita\
**The study uncovers noteworthy variations in economic performance, population diversity, and GDP per capita among the four countries.
Turkey stands out with the most significant economic disparities, indicating a diverse economic landscape.
In contrast, Finland appears to have a relatively stable and more uniform economy.
The United Kingdom boasts a high average GDP per capita; however, it experiences substantial internal variations.
The Czech Republic falls in between, showing moderate economic diversity.
These findings underscore the significance of acknowledging regional disparities and economic heterogeneity within these nations.

**Regional Inequality and Gini Coefficient\
**The Gini coefficient statistics provide valuable insights into the levels of regional inequality across the four countries.
The Czech Republic exhibits the lowest income inequality, reflecting a relatively equitable distribution.
Finland follows closely, indicating slightly more regional inequality but maintaining a reasonably balanced income structure.
Turkey experiences a higher degree of regional inequality, suggesting significant income disparities among its population.
The United Kingdom displays the highest regional inequality among the countries, characterized by a substantial income gap.
These findings shed light on the distribution of wealth and income disparities within these nations.

**Scatterplot Analysis\
**A visual examination of the scatterplots reinforces the observed trends.
Notably, regions within Finland and the Czech Republic demonstrate lower levels of income inequality compared to those in the UK and Turkey.
This suggests a more equitable income distribution in the former countries.
Additionally, a discernible trend is the inverse relationship between population size and income inequality within each nation.
This trend is particularly pronounced in Turkey, implying that larger populations tend to exhibit lower income disparities.

Intriguingly, the scatterplot for the UK presents a unique finding.
In contrast to the collective data for all countries, a slightly higher level of inequality is observed in larger regions within the UK.
This phenomenon might be attributed to the fact that larger cities in the UK often display a wider income gap between affluent and less fortunate residents.
This nuanced observation emphasizes the complexity of income distribution within the United Kingdom.

Overall, this study contributes to a deeper understanding of economic diversity and regional inequality within these four countries, emphasizing the significance of accounting for regional variations and population dynamics in economic analyses.

# Assignment 2: Cross-Sectional Estimates

The objective of this assignment is to explore the relationship between regional development and inequality by utilizing cross-sectional estimation techniques, focusing on NUTS 2 data from the year 2010.

## Part A: Growth and Inequity

In the first part, we will dive into growth and inequity.
First, we will estimate three simple linear regression models looking at the relationship between regional development and regional inequality.
Further, we will define our model specifications, justify variable selection, and explain the expected relationship.
Then, we will assess the goodness of fit and discuss the reliability and validity of the estimated models.
We will also discuss if the classical OLS assumptions hold.
Lastly, we will visualize our models with a fitted regression line.

### Model Estimation

To see how regional development affects regional inequality we will estimate three simple linear regression models with the population-weighted GDP Gini coefficient ($GINIW_j$) as the dependent variable and the GDP per capita ($y_j$ ) as the independent variable.
The population-weighted GDP Gini coefficient is chosen for measuring regional inequality, because it gives a nuanced view of regional inequality considering both GDP disparities and the population size in each region.
GDP per capita is a good measure for assessing regional development, because it provides an indicator of the overall living standard in each region.
For the estimation we will use a subset including only observations on NUTS 2 regions from the year 2010.
We will estimate three models for a better insight into how the relationship between regional inequality and regional development is in the different countries.
The first model include data from all our countries, the second model focuses only on EU countries, while the third model is all about the UK.
We dedicate a separate model to the UK, since this country accounts for almost half of the observations.
Below is the equation for our simple linear regression models:

$\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010}$

Based on @lessmann2017 study, we expect the relationship between regional development and regional inequality to follow a pattern similar to a N-shape.
By examining changes in inequality over time, @lessmann2017 found that the majority of all countries experience sigma convergence, which means that regional inequality decreases over time.
However, they found that some poor and lower-middle-income countries, along with some rich economies, show divergence.
This shows that very poor countries exhibit increasing inequalities, while most middle- and high-income countries show decreasing or stabilizing inequalities.
Interestingly, regional inequalities increase again in the richest countries, forming the right side of the N-shaped pattern [@lessmann2017].\

```{r}
#| echo: false
# Subset including nuts2 regions in 2010
subset_nuts2_2010 <- main_data_nuts2 |>
filter(grepl("2010", year))
```

```{r}
#| echo: false
# Estimate for all the countries
lm1 <- lm(gini_n2 ~ I(gdp_per_capita_n2 * 100) , data = subset_nuts2_2010)

# Estimate for the UK
lm2 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 == "UK") %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)

# Estimate for the EU countries
lm3 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)

# Generate regression table
huxreg(
  list("Model 1" = lm1, "Model 2" = lm2, "Model 3" = lm3),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "I(gdp_per_capita_n2 * 100)", Constant = "(Intercept)")
  )
```

The regression table reveals a positive relationship between regional development and regional inequality in both Model 1 and Model 2.
In Model 1, including all the countries, a 1% increase in GDP per capita corresponds to an average rise of 0.026 in the Gini coefficient.
Model 2, focused on the UK, strengthens this association, indicating a slightly higher increase of 0.032 in the Gini coefficient with a rise in GDP per capita.
However, for the EU countries in Model 3, the relationship between regional development and regional inequality is negative.
Here, a 1% increase in GDP per capita is linked to a 0.012 decrease in the Gini coefficient, suggesting that higher regional development in these countries is paradoxically associated with lower regional inequality.

### Model Diagnostics

We will take a look at how well the regression models fit the observed data by assessing the goodness of fit, discuss the reliability and validity of the models and see if the classic OLS-assumptions hold.

**Goodness of fit**\
We examine the goodness of fit by looking at the R-squared.
The R-squared values indicate the proportion of variation in regional inequality (Gini coefficient) that can be explained by regional development (GDP per capita) in each model.
The closer R-squared is to 1, the better the model is at explaining the variability.
The first model have a R-squared of 0.418, indicating that about 41.8% of the variability in the population-weighted Gini coefficient can be explained by the variation in GDP per capita.
In the second model, a higher R-squared of 0.602 suggest that the GDP per capita variable in this model does a better job of explaining the variability in regional inequality.
The third model has the lowest R-squared among the three models.
In the third model, the R-squared is 0.131, indicating that only 13.1% of the variability is explained.
This model seems to be less effective in capturing the relationship between regional development and regional inequality compared to the other models.

**Reliability and validity**\
Reliability is reflected in the precision of coefficient estimates.
Smaller standard errors indicate more reliable estimates.
All three models show relatively small standard errors, suggesting reasonable reliability in estimating the coefficients.
In Model 1 the standard error for the coefficient of GDP per capita is 0.003.
The standard error is 0.004 for model 2 and 0.005 for model 3.
Larger standard errors suggest less precision in the estimates, meaning there's more uncertainty about the true population values of the coefficients in those models.
We should also look at the R-squared values when assessing reliability.
Higher R-squared values suggest a better reliability in explaining variance.
Model 2 has the highest R-squared, indicating that it explains a larger proportion of the variance compared to the other models.
A lower R-squared suggests that Model 3 has less explanatory power compared to Models 1 and 2.
Only 13.1% of the variation in the dependent variable is captured by the variables included in this model.
It indicates that there might be other factors influencing the dependent variable that are not accounted for in Model 3.

Statistical significance, as indicated by star symbols and p-values, palys a cruical role in assessing the validity of the models.
A low P-value suggests that the predictor variable is likely a valid predictor of the response variable.
In our regression table, all coefficients demonstrate statistical significance, supporting the validity of the models.
The coefficients for "GDP_per_capita" in model 1 and model 2 exhibit extremely low p-values (\<0.001), signifying high significance at a 1% significance level.
Model 3, on the other hand, have a p-value of less than 0.05, indicating a significance at a 5% level.
Regarding the constant terms, model 3 stands out with a significance level of 1% (p \< 0.001).
This reinforces the reliability of Model 3, even though it has the lowest R-squared value.\

\
In summary, Model 2, boasting the highest R-squared value and statistically significant coefficient, appears to be the most reliable and valid among the three models.
Model 3, despite its lower R-squared value, still holds significance, especially with the constant term being the only one with a 1% significance level.

**OLS assumptions**\
The classical Ordinary Least Squares (OLS) assumptions are crucial for the validity of the regression results.
Lets see if these assumptions hold.

1.  **Linearity:** The linearity assumption posits that the relationship between the dependent variable $\hat{GINIW_{2010}}$ and the independent variable $y_{2010}$ is linear in parameters.This assumption is met because we specify a linear equation for our regression: $\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010}$.

2.  **Sample Variation:** This assumption necessitates that there is variation in the independent variables within our sample.
    Our independent variable "GDP_per_capita" exhibits variation as it evident from its coefficients in all three models.

3.  **Random Sampling:** The data used to estimate the regression models is obtained from Eurostat and the Office for National Statistics.
    This data are not random samples in the traditional statistical sense, since these organizations collect data from the entire population rather than a randomly selected sample.
    We don\`t have a truly random sample, but it could still be suitable for regression analysis as long as we aware of the potential biases.

4.  **Exogeneity:** The exogeneity assumption suggests that for any value of the independent variable, the mean of the error term is zero ($E(u|X) = 0$).
    The assumption holds if GDP per capita is not correlated with unobserved factors affecting the Gini coefficient.
    This may be the case, but we claim that the exogeneity assumption is fulfilled in our estimations.

5.  **Homoskedasticity:** Homoskedasticity implies that the error term's variance is constant across different values of the independent variable.
    It ensures that the spread of residuals is consistent.
    In our models, homoskedasticity appears to be violated in some cases, as indicated by the increasing standard errors ("constant" term in Model 1 and Model 3).
    This suggests that the spread of residuals may not be constant across all values of the independent variables.
    We test for homoskedasticity using a Breusch-Pagan test.

    ```{r}
    # Breusch-Pagan test for Model 1
    lm1_test <- lmtest::bptest(lm1)
    print(lm1_test)

    # Breusch-Pagan test for Model 2
    lm2_test <- lmtest::bptest(lm2)
    print(lm2_test)

    # Breusch-Pagan test for Model 3
    lm3_test <- lmtest::bptest(lm3)
    print(lm3_test)

    ```

    Model 1 shows evidence of heteroskedasticity, while Model 2 and Model 3 do not exhibit significant departures from homoskedasticity.

6.  **Normality:** The normality assumption states that the error term follows a normal distribution with a mean of zero and a constant variance ($\sigma^2$).
    We test normality with three Q-Q plots, one for each of the estimation models.

    ```{r}
    # Q-Q plot for Model 1
    qqnorm(residuals(lm1))
    qqline(residuals(lm1))

    # Q-Q plot for Model 2
    qqnorm(residuals(lm2))
    qqline(residuals(lm2))

    # Q-Q plot for Model 3
    qqnorm(residuals(lm3))
    qqline(residuals(lm3))
    ```

The points in each plot follow a straight line, suggesting that the residuals are approximately normally distributed.
Model 1 exhibits the best fit to the line, followed by Model 2 and then Model 3, indicating that the residuals in Model 1 adhere more closely to a normal distribution than those in the other models.

### Visualization

We will visualize the relationship between regional development and regional inequality, incorporating the fitted regression line in three different plots, one for each estimation.

```{r}
#| echo: false
# Plot for all countries
plot_all <- subset_nuts2_2010 %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for All Countries",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 region")

plot_all
```

The figure visualize the relationship between regional development and regional inequality for NUTS 2 regions in the year 2010 for all the countries.
The figure have GDP per capita on the x-axis and Gini coefficient on the y-axis.
The black line represent the estimated relationship.
The figure shows a positive relationship between regional development and regional inequality.

```{r}
#| echo: false
# Plot for the UK
plot_UK <- subset_nuts2_2010 %>%
  filter(id_nuts0 == "UK") %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for the UK",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions") 

plot_UK
```

This visualization illustrates the connection between regional development and inequality within NUTS 2 regions for the UK in the year 2010.
Plotted with GDP per capita on the x-axis and the Gini coefficient on the y-axis, the black line signifies the estimated relationship between these two variables.
The line confirms a positive relationship.

```{r}
#| echo: false
# Plot for the EU countries
plot_EU <- subset_nuts2_2010 %>%
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for EU Countries",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions")

plot_EU
```

The figure visualize the relationship between regional development and regional inequality for NUTS 2 regions in the year 2010 for the EU countries.
With GDP per capita on the x-axis and Gini coefficient on the y-axis, the black line serves the estimated relationship between these two.
We can see from the figure that the relationship is negative.

## Part B: Exploring Other Determinants of Inequity

In the second part, we will explore three other potential determinants that we hypothesize may influence regional inequity.
First, an explanation of the data acquisition will be given.
Further, we will estimate a multiple linear regression model incorporating the newly selected variables alongside regional development, with regional inequality.
Then, we will define our model specifications and clarify why we expect the selected variables to influence regional inequality.
Lastly, we will interpret the estimated coefficients, reflect on the overall fit of the model, and discuss the contribution of each variable to explaining variations in regional inequality.

### Data Acquisition

We will take a look at three potential determinants of regional inequality for the year 2010 for the nuts 2 regions in Tureky.
We hypothesize that unemployment, infrastructure and life expectancy to influence regional inequality in Turkey.
We believe these three can have an impact on regional inequality because:

High unemployment rates can contribute to regional inequality.
We include unemployment as a variable to assess its impact on inequality.
Higher unemployment rates might lead to increased inequality due to income disparities.
Infrastructure, such as transportation and communication networks, is essential for economic development and reducing regional inequality.
Regions with better infrastructure may experience lower levels of inequality.
Life expectancy can be an indicator of the overall well-being of a region.
Regions with higher life expectancies may have better healthcare and social support systems, potentially reducing inequality.

We retrieved data for these potential determinants from Eurostat.

```{r}
#| echo: false
# Data aquisition: Unemployment (per thousand persons) for Turkey
unemployment <- read_csv("lfst_r_lfu3pers__custom_8264488_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, unemployment = OBS_VALUE)
```

```{r}
#| echo: false
# Data aquisition: Road, rail and inland waterways (km pr thousand square) for Turkey
infrastructure <- read_csv("tran_r_net__custom_8264840_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, infrastructure = OBS_VALUE)
```

```{r}
#| echo: false
# Data aquisition: Life expenctancy (years) for Turkey
life_expectancy <- read_csv("demo_r_mlifexp__custom_8282936_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, life_expectancy = OBS_VALUE)
```

```{r}
#| echo: false
# Join unemployment, infrastructure and life expenctancy datasets
determinants_1 <- unemployment |>
  left_join(infrastructure, join_by(year, id_nuts2))

determinants_2 <- determinants_1 |>
  left_join(life_expectancy, join_by(year, id_nuts2)) |>
  select(year, id_nuts2, unemployment, infrastructure, life_expectancy)
```

```{r}
#| echo: false
# Converting the "year" variable into a character
subset_nuts2_2010$year <- as.character(subset_nuts2_2010$year)
determinants_2$year <- as.character(determinants_2$year)

# Join dataset with determinants with subset_nuts2_2010
TR_nuts2_2010 <- subset_nuts2_2010 |>
  filter(id_nuts0 == "TR", year == "2010") |>
  left_join(determinants_2, join_by(year, id_nuts2))
```

### Multiple Linear Regression Model

We will now estimate a multiple linear regression model incorporating the newly selected variables unemployment, infrastructure and life expectancy alongside regional development, with regional inequality for NUTS 2 regions in Turkey for the year 2010.

With the population-weighted GDP Gini coefficient ($GINIW_j$) as the dependent variable and the GDP per capita ($y_j$ ), unemployment, life expectancy and infrastructure as the independent variables.

$\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010} +\hat{\beta}_2 X_{2010} +\hat{\beta}_3 X_{2010} + \hat{\beta}_4 X_{2010}$

```{r}
#| echo: false

ML_regressionmodel <- TR_nuts2_2010

# Multiple linear regression model

model <- lm(gini_n2 ~ I(gdp_per_capita_n2 * 100) + I(unemployment * 100) + I(infrastructure * 100) + I(life_expectancy * 100), data = ML_regressionmodel)

# R-squared (R²) value
r_squared <- summary(model)$r.squared

# Number of observations (nobs)
num_observations <- summary(model)$nobs

# View the summary of the regression
summary(model)
```

### Model Interpretation

**Residuals**\
The residuals represent the differences between the observed values of gini_n2 and the predicted values from the regression model.
The statistics provide insights into how well the model fits the data.

The minimum residual is approximately -0.04744, indicating the smallest underprediction by the model.When it comes to the first Quartile, about 25% of the residuals fall below -0.02787, suggesting that the model typically underpredicts by this amount.The median residual is -0.00551, indicating that half of the residuals are above and half are below this value.The third Quartile shows that about 75% of the residuals are below 0.02146, showing that the model generally underpredicts.The maximum residual is approximately 0.09078, representing the largest overprediction by the model.

**Coefficients**\
This section provides the estimated coefficients for each independent variable and the intercept (constant term).
The coefficients represent the relationships between the independent variables and the dependent variable gini_n2.
Here's an explanation of each coefficient:

The intercept, approximately 0.3101, is the estimated value of gini_n2 when all independent variables are zero.
The coefficient for gdp_per_capita_n2, approximately 0.003383, indicates that for every 1% increase in gdp_per_capita_n2, gini_n2 is expected to increase by this amount.The coefficient for unemplyment approximately -7.72e-07, suggests that a 1% increase in unemployment is associated with a decrease in gini_n2 by this amount.
The coefficient for infrastructure, approximately -6.002e-06, indicates that a 1% increase in infrastructure is associated with a decrease in gini_n2 by this amount.
The coefficient for life_expectancy, approximately -3.253e-05, suggests that a 1% increase in life expectancy is linked to a decrease in gini_n2 by this amount.

**Standard error\
**The standard error associated with each coefficient measures the precision of the estimate.
Smaller standard errors indicate more precise estimates.
The t-value is the ratio of the estimate to the standard error.
It's used to test the significance of each coefficient.
A t-value close to zero suggests that the variable may not be statistically significant.
The Pr(\>\|t\|) (p-value) indicates the probability of observing such a t-statistic, assuming the null hypothesis that the coefficient is zero.
Smaller p-values (typically below 0.05) suggest that the coefficients are statistically significant.
The resiudual standard error, approximately 0.03516, represents the standard deviation of the residuals.
It measures the average magnitude of the prediction errors.

**Multiple R-squared\
**The multiple R-squared value of 0.1497 represents the proportion of the variation in gini_n2 that can be explained by the independent variables in the model.
In this case, about 14.97% of the variability in gini_n2 is explained by the model, while the rest remains unexplained.

**Adjusted R-squared**\
The adjusted R-squared adjusts the multiple R-squared for the number of independent variables in the model.
In this case, it's approximately 0.0773, indicating the proportion of the variation that the model explains while accounting for the complexity of the model.

**F-statistic and p-value\
**The F-statistic tests the overall significance of the model.
A higher F-statistic indicates a more significant model.
In this case, the F-statistic is 2.068, and it is tested with 4 and 47 degrees of freedom.

The p-value associated with the F-statistic (0.1001) indicates the probability of observing an F-statistic as extreme as the one you have under the null hypothesis, which is that the model has no explanatory power.
In this case, the p-value is relatively high, suggesting that the model may not be statistically significant at conventional significance levels (e.g., 0.05).

In summary, our regression model attempts to explain regional inequality using several economic and social indicators.
The low R-squared and relatively high p-value for the F-statistic suggest that the model may not be a good fit for the data, and the individual coefficients provide insights into how each independent variable affects regional inequality.

# Assignment 3: Alternative Functional Forms and Panel Estimation

In this assignment, we will explore alternative functional forms and implementing panel estimates to analyze the relationship between regional development and inequality.

## Part A: Testing Development Effects Across Subsets

In the first part, we will test development effects across subsets.
First, we will estimate the effect of regional development on inequality within each subset and test if the effects significantly differ.
Then, we will interpret and discuss the results, focusing on differences in development effects across subsets.

### Subset Analysis

### Subset Analysis Discussion

## Part B: Exploring Alternative Functional Forms

The second part involves exploring alternative functional forms, where we decided to focus on ... and ... forms.
An estimation and visualization of the ... and ... models will be given.
Lastly, we will discuss the results and the fit of the alternative models compared to the original linear model.

### Functional Form Exploration

### Estimation and Visualization

### Results Interpretation

## Part C: Heteroskedasticity Testing and Causality Discussion

In the third part, we will test for heteroskedasticity in the alternative and original models.
We will also reflect on the causal interpretation of the models and suggest strategies to address any issues identified.

### Heteroskedasticity Testing

### Causality Discussion

## Part D: Panel Estimates

In part D, we conduct panel estimates using the entire dataset, examining the impact of regional development on regional inequality.
We use various panel estimation techniques, incorporating different fixed effects - both separately and jointly.
We interpret the panel estimation results and compare the panel estimates with the cross-sectional estimates from earlier, discussing the advantages and limitations of each approach.
Lastly, we will critically evaluate the panel estimation findings, considering potential biases, inconsistencies, or limitations in the methodology.

### Panel Estimation Task

### Panel Estimation Analysis

### Panel Estimation Discussion

# References
