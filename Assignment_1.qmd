---
title: "Assignment_1"
format: pdf
editor: visual
bibliography: MSB104.bib
---

```{r}
#| label: setup
#| echo: false
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(magrittr)
library(knitr)
library(dineq)
library(ineq)
library(ggplot2)
library(scales)
library(cowplot)
```

# Assignment 1: Data and Descriptive

This assignment aims to obtain, process, and analyze sub-national GDP and population data for a subset of European countries.
The selected subset comprises the Czech Republic, Turkey, Finland and the United Kingdom.
The objective is to calculate GDP per capita and explore regional inequity using a range of descriptive statistics and visualizations.

## Part A: Sub-national GDP and GDP per Capita

In the first part, we will dive into sub-national GDP for the selected European countries.
Firstly, a brief overview of the data acquisition will be given.
Furthermore, we will calculate GDP per capita for each sub-region.
Lastly, we will provide a descriptive analysis that gives insights into the distribution and the central tendencies of the data.

### Data Acquisition

The assignment is based on datasets providing sub-regional data on GDP and population from the year 2000 to 2020.
We had to obtain data for the UK in a different way than for the rest of the countries.
We will now take you through the data acquisition.

We obtained data for the EU countries (Czech Republic, Turkey and Finland) from Eurostat.
We downloaded two datasets, one providing GDP data (nama_10r_3gdp) and the other one providing population data (demo_r_pjanaggr3).
The NUTS classification is a hierarchical system that enables cross-border statistical comparisons at various regional levels within the EU.
The datasets we downloaded from Eurostat are at a NUTS 3 level.

We needed just a few of the variables included in the two datasets from Eurostat.
After importing the two datasets, we used the select()-function to pick the variables we wanted and gave them some more appropriate names.
We ended up with three variables in each dataset; "year", "geo", and "gdp"/"pop".

```{r}
# GDP data for Czech Republic, Turkey and Finland
gdp_data <- read_csv("nama_10r_3gdp__custom_7667248_linear.csv") |>
  filter(unit == "MIO_EUR") |>
  select(year = TIME_PERIOD, geo, gdp = OBS_VALUE)
```

```{r}
# Population data for Czech Republic, Turkey and Finland
population_data <- read_csv("demo_r_pjanaggr3__custom_7667383_linear.csv") |>
  select(year = TIME_PERIOD, geo, pop = OBS_VALUE)
```

The UK is not included in the datasets from Eurostat, since the country is no longer a part of the EU.
We got sub-regional GDP and population data for the UK from the Office for National Statistics.
The dataset we downloaded is called "Regional gross domestic product; all ITL regions".
The UK uses another classification system than the EU.
Instead of NUTS regions, they use ITL regions.
These two classification systems work on the same principle and we will from now on, refer to all regions as NUTS.

```{r}
# GDP data for UK
gdp_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 5", skip = 1)
```

```{r}
# Population data for UK
population_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 6", skip = 1)
```

To get the two UK datasets in the same format as the datasets from Eurostat, we used the gather()-function to convert the dataset from wide to long format.
With filter() and mutate() we made a "geo" variable showing regions at a NUTS 3 level.
We used the select()-function to pick the same variables we have in the datasets for the EU countries.

```{r}
# Reforming gdp_UK
gdp_UK <- gdp_UK %>%
  gather(year, gdp, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, gdp) %>%
  arrange(geo)
```

```{r}
# Reforming population_UK
population_UK <- population_UK %>%
  gather(year, pop, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, pop) %>%
  arrange(geo)
```

When sub-regional GDP and population data for both the EU countries and the UK were in place, we could start merging the datasets.
First, we merged the gdp dataset and the population dataset for the EU countries.
Then, we merged the two datasets for the UK.
When merging the UK datasets, we replaced "TL" with "UK" in the NUTS 3 code.
Finally, we merged the EU dataset with the UK dataset to get one dataset containing sub-regional GDP and population for all the countries.
We named the final dataset for "main_dataset".

```{r}
# Merging gdp dataset with population dataset for the EU countries
merged_data <- gdp_data |>
  left_join(population_data, join_by(year,geo))
```

```{r}
# Merging gdp dataset with population dataset for the UK
merged_UK <- gdp_UK |>
  left_join(population_UK, join_by(year,geo))
merged_UK$geo <- gsub("TL", "UK", merged_UK$geo)
```

```{r}
# Converting the "year" variable into a character
merged_data$year <- as.character(merged_data$year)
merged_UK$year <- as.character(merged_UK$year)
```

```{r}
# Merging EU dataset with UK dataset
main_data <- full_join(merged_data, merged_UK) 
```

```{r}
# We only want data from year 2000 to 2020
main_data <- main_data %>%
  subset(main_data$year >= 2000 & main_data$year <= 2020)
```

```{r}
# Clean up
rm(gdp_data, population_data, gdp_UK, population_UK, merged_data, merged_UK)
```

### GDP per Capita Calculation

Now that our datasets are joined, we can create a new variable for GDP per capita in our main dataset by dividing the "gdp" column by the "pop" column.
We do this by taking our main_data and using the mutate() - function, and the formula:

$y_{i} = \frac{GDP_{i}}{Population_{i}}$

```{r}
# Adding GDP per capita in the main_data
main_data <- main_data %>%
  mutate(gdp_per_capita = round(gdp / pop, digits = 4))
```

GDP per capita gives an average representation of the economic well-being of individuals in a country, indicating the amount of economic output generated, by each person.
it is often used as an indicator of the standard living and economic development within a country.

### Descriptive Analysis

Through descriptive statistic we will summarize and describe the main features and key characteristics of the dataset.
First, we will summarize the descriptive statistics for each country.
The summary contains minimum value, median, mean, quartiles and maximum value for each country.

```{r}
# Create subsets for each country and exclude "year" and "geo" columns
data_FI <- subset(main_data, grepl("^FI", geo))
data_UK <- subset(main_data, grepl("^UK", geo))
data_CZ <- subset(main_data, grepl("^CZ", geo))
data_TR <- subset(main_data, grepl("^TR", geo))

# Generate summary statistics for each country
summary_FI <- summary(data_FI[, !(names(data_FI) %in% c("year", "geo"))])
summary_UK <- summary(data_UK[, !(names(data_UK) %in% c("year", "geo"))])
summary_CZ <- summary(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))])
summary_TR <- summary(data_TR[, !(names(data_TR) %in% c("year", "geo"))])

# Create tables using kable
kable(summary_FI, caption = "Summary Statistics for Finland (FI)")
kable(summary_UK, caption = "Summary Statistics for United Kingdom (UK)")
kable(summary_CZ, caption = "Summary Statistics for Czech Republic (CZ)")
kable(summary_TR, caption = "Summary Statistics for Turkey (TR)")

```

Turkey (TR) exhibits a broad range of economic performance.
The country's GDP varies significantly, with a minimum GDP of 196.8 and a maximum GDP of 242,730.0.
The population size is also diverse, with a minimum population of 74,412 and a maximum population of 15,067,724.
The average GDP per capita is relatively low, at 0.0061.
This suggests that there is substantial diversity in economic well-being and population size in Turkey.

In contrast, Finland (FI) showcases a more homogenous economic landscape.
The country's GDP is less variable, ranging from 57.56 to 95,458.36.
The population size, although not as extensive as Turkey, still exhibits diversity, with a minimum of 25,706 and a maximum of 1,671,024.
The average GDP per capita is 0.0312, reflecting a relatively higher economic well-being on average.

The United Kingdom (UK) presents a diverse economic environment.
While the minimum GDP is 320, it reaches a high of 117,051.
Population size varies from 19,220 to 1,195,672.
The UK exhibits the highest average GDP per capita among the studied countries, standing at 0.0261.
This suggests significant disparities in economic well-being and population size within the United Kingdom.

The Czech Republic's (CZ) economic landscape falls between Turkey and Finland.
The GDP ranges from 1,702 to 61,602, demonstrating moderate variability.
The population size also varies, with a minimum of 294,896 and a maximum of 1,369,332.
The average GDP per capita is 0.0130, indicating a moderate level of economic well-being on average.

**Standard deviation**

The standard deviations help us understand the degree of variability in GDP, population, and GDP per capita across the dataset, we use the std_deviation() - function to calculate this.

```{r}
# standard deviation
# the column names for which we want to calculate the sd
columns_of_interest <- c("gdp", "pop", "gdp_per_capita")
# Store it in a empty vector
std_deviations <- numeric(length(columns_of_interest))
# Calculating the standard deviation, and removing "NA"
for (i in 1:length(columns_of_interest)) {
  col_name <- columns_of_interest[i]
  std_deviations[i] <- sd(main_data[[col_name]], na.rm = TRUE)
}
# Print the standard deviations
std_deviations
```

The standard deviation for GDP is approximately 13,428.01.
This indicates a significant amount of variation in GDP values across the dataset.
A high standard deviation suggests that GDP values are dispersed or spread out from the mean.
In this context, it means that the GDP values for regions within the dataset vary considerably, with some regions having very high GDPs and others having lower GDPs.

The standard deviation for population (pop) is approximately 830,187.
This suggests a substantial degree of variation in population sizes among the regions within the dataset.
The large standard deviation indicates that some regions have significantly larger populations than others.

The standard deviation for GDP per capita is approximately 0.02497833.
It is a relatively low value compared to the other variables.
This implies that the GDP per capita values across the regions are less dispersed and closer to the mean.
In this context, it indicates that there is less variation in economic well-being among regions in terms of GDP per capita.

## Part B: Regional Inequity

The second part focuses on regional inequality.
We will start with a literate review of the subject, then compute population-weighted GDP Gini coefficients for the regions within our subset of European countries.
This includes data presentation through descriptive statistics and visuals.
In the end, we will discuss the computed Gini coefficients and reflect on the implications of our findings in the context of regional inequity.

### Literature Review

Regional inequality refers to the disparities in economic development, income, and other socio-economic indicators among different geographical regions within a country or across countries.

We should care about regional inequality because it is essential for sustainable and inclusive development in the future.
Regional inequality can have significant social, economic, and political implications.
It is an important topic that raises questions regarding the consequences and how we should deal with it.
Focusing on regional inequality is important for both the economy and social welfare in general [@lessmann2017] .
Addressing regional inequality is important for ensuring that the benefits of economic growth are shared more equitably among all citizens.
It is all about creating a more balanced and fair society.

### Gini Coefficient Calculation

Measuring regional inequality is challenging because it is difficult to compare regions of different sizes.
The number of regions by each country also varies in our dataset.
To deal with this issue, we can use a population-weighted Gini coefficient that accounts for different sizes of the regions [@lessmann2017] .

To compute the population-weighted GDP Gini coefficient for each European NUTS 2 level region within the subset of countries, we used the formula below:

$GINW_j=\frac{1}{2\overline y j} \sum_{i}^{n_j} \sum_{l}^{n_j} \frac{p_i}{P_j} \frac{p_l}{P_j} |y_i - y_l|$

First, we created a new dataset (main_data_2) that includes three new variables with NUTS 0, NUTS 2 and NUTS 3 regions.
Then, we calculated the population-weighted GDP gini coefficient for each NUTS 2 level region.

```{r}
# Creating NUTS 2 and NUTS 0 level
main_data_2 <- main_data |>
  mutate(id_nuts3 = geo,
         id_nuts2 = substr(geo, 1,4),
         id_nuts0 = substr(geo, 1, 2)
         )
```

```{r}
# Calculating the population-weighted GDP Gini coefficient for each NUTS 2 level region
main_data_2 <- main_data_2 |>
  filter(pop != "NA") |>
  filter(pop != 0) |>
  filter(gdp_per_capita != "NA") |>
  group_by(id_nuts2, year) |>
  mutate(gini_n2 = round(gini.wtd(gdp_per_capita, weights = pop), digits = 4)) |>
  ungroup()
```

```{r}
# Cleaning the dataset
main_data_2 <- main_data_2 %>%
  select(year, id_nuts3, id_nuts2, id_nuts0, gdp, pop, gdp_per_capita, gini_n2, -geo)
```

Further, we created main_data_nuts2 that contains only the first row of each group defined by the combination of "id_nuts_2" and "year" from the dataset "main_data 2".

```{r}
main_data_nuts2 <- main_data_2 |>
 group_by(id_nuts2, year) |>
  slice(1)
```

### Data Presentation

We created a table to get a overview of the population-weighted GDP gini coefficient for each country (NUTS 0 regions).

```{r}
# Calculating Gini Coefficient at a NUTS 0 level
gini_nuts0 <- main_data_nuts2 |>
  filter(!is.na(gini_n2)) |>
  group_by(id_nuts0) |>
  summarize(
    Mean = mean(gini_n2),
    Variance = var(gini_n2),
    Max = max(gini_n2),
    Min = min(gini_n2)
  )
```

```{r}
# Table
gini_nuts0 |>
  kable()
```

From the table we see that the Czech Republic exhibits relatively low regional inequality.
It has a mean of 0.0131, indicating lowest regional inequality on average among the countries.
The data has low variance (0.0002), suggesting a relatively stable distribution.
The maximum Gini coefficient observed is 0.0353, while the minimum is 0.
This indicates a fairly equitable income distribution within the country.

Finland follows with slightly higher mean and maximum value.
The Gini coefficient has a higher mean value of 0.0282, indicating slightly more regional inequality compared to the Czech Republic.
The variance is also higher (0.0006), suggesting more variability in income distribution.
The maximum Gini coefficient observed is 0.0708, and the minimum is 0.
Finland's income distribution is relatively equitable but slightly more diverse than that of the Czech Republic.

Turkey displays a higher level of regional inequality, with a mean Gini coefficient of 0.0544.
The data exhibits greater variance (0.0015), indicating significant income disparities.
The maximum Gini coefficient observed is 0.1642, emphasizing the presence of considerable regional inequality within the country.
However, the minimum is 0, highlighting the absence of perfectregional equality.

The United Kingdom experiences the highest regional inequality among the studied countries, with a mean Gini coefficient of 0.0917.
The variance is substantial (0.0067), signifying a wide range of income disparities.
The maximum Gini coefficient observed is 0.4925, while there is no recorded minimum (0).
The UK's income distribution is characterized by a significant degree of inequality.

#### Subset 2018 from main_data_nuts2:

We chose to look further at data from year 2018.
Within this subset, we focused on NUTS2 regions in the four countries: Czechia, Turkey, the United Kingdom (UK), and Finland.
Our aim was to explore potential trends in regional inequality, as measured by the Gini coefficient, in relation to the population of these NUTS2 regions.

```{r}
subset_nuts2data <- main_data_nuts2 %>%
  filter(grepl("2018", year))
```

To visualize these trends more effectively for each region, we employed a scatterplot.
In this plot, we assigned different colors to represent the Gini coefficients of each region.
This allowed us to examine and compare how regional inequality may vary concerning population size for each of the mentioned countries.

To create these visualizations, we utilized the ggplot2 library in R, enabling us to analyze and depict the data effectively.

```{r}
# Create the scatterplot
scatter_plot <- ggplot(subset_nuts2data, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")
  
# Add the regression line
scatter_plot <- scatter_plot +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black")

scatter_plot
```

We opted to exclude a specific NUTS2 region within the UK, located in London, due to its unusually high level of inequality, which deviated significantly from the patterns observed in other regions.
This decision was made to ensure a more accurate and representative analysis.
Additionally, we omitted Istanbul from the dataset, primarily because it is significantly larger than any other city in the dataset, and its unique characteristics could potentially skew the overall analysis:\

```{r}
# Create the scatterplot
scatter_plot2 <- ggplot(subset_nuts2data, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region") +
  scale_x_continuous(limits = c(0, 6000000)) +
  scale_y_continuous(limits = c(0, 0.3))  # Set the y-axis limits to 0.3

# Add the regression line
scatter_plot2 <- scatter_plot2 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )

scatter_plot2
```

#### Subset UK from nuts2:

We also created a subset of the 'main_data_nuts2' specifically for the United Kingdom (UK) due to its extensive dataset.
Our objective was to closely examine whether the trend in the Gini coefficient was consistent within the UK, as it was for all the NUTS2 regions across various countries.

```{r}
subset_nuts2data_UK <- main_data_nuts2 %>%
  filter(grepl("^UK", id_nuts2) & year == 2018)
```

To achieve this, we generated a new scatterplot using the 'ggplot()' function.

```{r}
# Create the scatterplot
scatter_plot3 <- ggplot(subset_nuts2data_UK, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")  
# Add the regression line
scatter_plot3 <- scatter_plot3 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )
  
scatter_plot3

```

### Discussion

**Economic Performance and GDP per Capita\
**The study uncovers noteworthy variations in economic performance, population diversity, and GDP per capita among the four countries.
Turkey stands out with the most significant economic disparities, indicating a diverse economic landscape.
In contrast, Finland appears to have a relatively stable and more uniform economy.
The United Kingdom boasts a high average GDP per capita; however, it experiences substantial internal variations.
The Czech Republic falls in between, showing moderate economic diversity.
These findings underscore the significance of acknowledging regional disparities and economic heterogeneity within these nations.

**Regional Inequality and Gini Coefficient\
**The Gini coefficient statistics provide valuable insights into the levels of regional inequality across the four countries.
The Czech Republic exhibits the lowest income inequality, reflecting a relatively equitable distribution.
Finland follows closely, indicating slightly more regional inequality but maintaining a reasonably balanced income structure.
Turkey experiences a higher degree of regional inequality, suggesting significant income disparities among its population.
The United Kingdom displays the highest regional inequality among the countries, characterized by a substantial income gap.
These findings shed light on the distribution of wealth and income disparities within these nations.

**Scatterplot Analysis\
**A visual examination of the scatterplots reinforces the observed trends.
Notably, regions within Finland and the Czech Republic demonstrate lower levels of income inequality compared to those in the UK and Turkey.
This suggests a more equitable income distribution in the former countries.
Additionally, a discernible trend is the inverse relationship between population size and income inequality within each nation.
This trend is particularly pronounced in Turkey, implying that larger populations tend to exhibit lower income disparities.

Intriguingly, the scatterplot for the UK presents a unique finding.
In contrast to the collective data for all countries, a slightly higher level of inequality is observed in larger regions within the UK.
This phenomenon might be attributed to the fact that larger cities in the UK often display a wider income gap between affluent and less fortunate residents.
This nuanced observation emphasizes the complexity of income distribution within the United Kingdom.

Overall, this study contributes to a deeper understanding of economic diversity and regional inequality within these four countries, emphasizing the significance of accounting for regional variations and population dynamics in economic analyses.
