---
title: "Assignment_1"
format: html
editor: visual
bibliography: MSB104.bib
---

```{r}
#| label: setup
#| echo: false
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(magrittr)
library(knitr)
library(dineq)
library(ineq)
library(ggplot2)
library(scales)
library(cowplot)
```

# Assignment 1: Data and Descriptive

This assignment aims to obtain, process, and analyze sub-national GDP and population data for a subset of European countries.
The selected subset comprises the Czech Republic, Turkey, Finland and the United Kingdom.
The objective is to calculate GDP per capita and explore regional inequity using a range of descriptive statistics and visualizations.

## Part A: Sub-national GDP and GDP per Capita

In the first part, we will dive into sub-national GDP for the selected European countries.
Firstly, a brief overview of the data acquisition will be given.
Furthermore, we will calculate GDP per capita for each sub-region.
Lastly, we will provide a descriptive analysis that gives insights into the distribution and the central tendencies of the data.

### Data Acquisition

The assignment is based on datasets providing sub-regional data on GDP and population from the year 2000 to 2020.
We had to obtain data for the UK in a different way than for the rest of the countries.
We will now take you through the data acquisition.

We obtained data for the EU countries (Czech Republic, Turkey and Finland) from Eurostat.
We downloaded two datasets, one providing GDP data (nama_10r_3gdp) and the other one providing population data (demo_r_pjanaggr3).
The NUTS classification is a hierarchical system that enables cross-border statistical comparisons at various regional levels within the EU.
The datasets we downloaded from Eurostat are at a NUTS 3 level.

We needed just a few of the variables included in the two datasets from Eurostat.
After importing the two datasets, we used the select()-function to pick the variables we wanted and gave them some more appropriate names.
We ended up with three variables in each dataset; "year", "geo", and "gdp"/"pop".

```{r}
# GDP data for Czech Republic, Turkey and Finland
gdp_data <- read_csv("nama_10r_3gdp__custom_7667248_linear.csv") |>
  filter(unit == "MIO_EUR") |>
  select(year = TIME_PERIOD, geo, gdp = OBS_VALUE)
```

```{r}
# Population data for Czech Republic, Turkey and Finland
population_data <- read_csv("demo_r_pjanaggr3__custom_7667383_linear.csv") |>
  select(year = TIME_PERIOD, geo, pop = OBS_VALUE)
```

The UK is not included in the datasets from Eurostat, since the country is no longer a part of the EU.
We got sub-regional GDP and population data for the UK from the Office for National Statistics.
The dataset we downloaded is called "Regional gross domestic product; all ITL regions".
The UK uses another classification system than the EU.
Instead of NUTS regions, they use ITL regions.
These two classification systems work on the same principle and we will from now on, refer to all regions as NUTS.

```{r}
# GDP data for UK
gdp_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 5", skip = 1)
```

```{r}
# Population data for UK
population_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 6", skip = 1)
```

To get the two UK datasets in the same format as the datasets from Eurostat, we used the gather()-function to convert the dataset from wide to long format.
With filter() and mutate() we made a "geo" variable showing regions at a NUTS 3 level.
We used the select()-function to pick the same variables we have in the datasets for the EU countries.

```{r}
# Reforming gdp_UK
gdp_UK <- gdp_UK %>%
  gather(year, gdp, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, gdp) %>%
  arrange(geo)
```

```{r}
# Reforming population_UK
population_UK <- population_UK %>%
  gather(year, pop, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, pop) %>%
  arrange(geo)
```

When sub-regional GDP and population data for both the EU countries and the UK were in place, we could start merging the datasets.
First, we merged the gdp dataset and the population dataset for the EU countries.
Then, we merged the two datasets for the UK.
When merging the UK datasets, we replaced "TL" with "UK" in the NUTS 3 code.
Finally, we merged the EU dataset with the UK dataset to get one dataset containing sub-regional GDP and population for all the countries.
We named the final dataset for "main_dataset".

```{r}
# Merging gdp dataset with population dataset for the EU countries
merged_data <- gdp_data |>
  left_join(population_data, join_by(year,geo))
```

```{r}
# Merging gdp dataset with population dataset for the UK
merged_UK <- gdp_UK |>
  left_join(population_UK, join_by(year,geo))
merged_UK$geo <- gsub("TL", "UK", merged_UK$geo)
```

```{r}
# Converting the "year" variable into a character
merged_data$year <- as.character(merged_data$year)
merged_UK$year <- as.character(merged_UK$year)
```

```{r}
# Merging EU dataset with UK dataset
main_data <- full_join(merged_data, merged_UK) 
```

```{r}
# We only want data from year 2000 to 2020
main_data <- main_data %>%
  subset(main_data$year >= 2000 & main_data$year <= 2020)
```

```{r}
# Clean up
rm(gdp_data, population_data, gdp_UK, population_UK, merged_data, merged_UK)
```

### GDP per Capita Calculation

Now that our datasets are joined, we create a new variable for GDP per capita in our main dataset by dividing the "gdp" column by the "pop" column.
We do this by taking our main_data and using the mutate() - function, and the formula:

$y_{i} = \frac{GDP_{i}}{Population_{i}}$

```{r}
# Adding GDP per capita in the main_data
main_data <- main_data %>%
  mutate(gdp_per_capita = gdp / pop)
```

The GDP per capita gives an average representation of the economic well-being of the individuals in the regions, indicating the amount of economic output generated, by each person.
It is often used as an indicator of the standard of living and economic development within a region or country.

### Descriptive Analysis

The GDP in the dataset is measured at current market prices by NUTS3 regions in millions of Euros for Czech Republic, Turkey and Finland, and in millions of Pounds for the United Kingdom.
The population variable shows total annual population within each NUTS 3 region.
The GDP per capita therefore indicates GDP in millions of Euros/Pounds per capita in each NUTS 3 region.

Through descriptive statistic we will summarize and describe the main features and key characteristics of the dataset.
We will present a summary of the descriptive statistics for each country.
The summary contains minimum and maximum value, median, mean, quartiles, variance and standard deviation for gdp, population and gdp per capita.

```{r}
# Create subsets for each country and exclude "year" and "geo" columns
data_CZ <- subset(main_data, grepl("^CZ", geo))
data_TR <- subset(main_data, grepl("^TR", geo))
data_FI <- subset(main_data, grepl("^FI", geo))
data_UK <- subset(main_data, grepl("^UK", geo))

# Generate summary statistics for each country
summary_CZ <- summary(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))])
summary_TR <- summary(data_TR[, !(names(data_TR) %in% c("year", "geo"))])
summary_FI <- summary(data_FI[, !(names(data_FI) %in% c("year", "geo"))])
summary_UK <- summary(data_UK[, !(names(data_UK) %in% c("year", "geo"))])

# Calculate variance and standard deviation for each variable (excluding NA values)
var_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], sd, na.rm = TRUE)

# Add variance and standard deviation to the summary tables
summary_CZ <- rbind(summary_CZ, var = var_CZ, sd = sd_CZ)
summary_TR <- rbind(summary_TR, var = var_TR, sd = sd_TR)
summary_FI <- rbind(summary_FI, var = var_FI, sd = sd_FI)
summary_UK <- rbind(summary_UK, var = var_UK, sd = sd_UK)

# Create tables using kable
kable(summary_CZ, caption = "Figure 1: Summary Statistics for Czech Republic (CZ)")
kable(summary_TR, caption = "Figure 2: Summary Statistics for Turkey (TR)")
kable(summary_FI, caption = "Figure 3: Summary Statistics for Finland (FI)")
kable(summary_UK, caption = "Figure 4: Summary Statistics for United Kingdom (UK)")
```

The Czech Republic's (CZ) regional GDP ranges from a minimum value of 1702 million Euros to a maximum value of 61602 million Euros.
The mean GDP is 10291 million Euros and the standard deviation 9504.78 million euros.
This indicates a moderate overall economic output for the country.
The mean of the population in the NUTS 3 regions within Czech Republic is 748,180 people, with a standard deviation of 320,076.68.
The average GDP per capita is 0.0130 million euros, indicating a moderate level of economic well-being on average among the regions.
The range of GDP per capita in the Czech Republic is from 0.005030 million euros to 0.047073 million euros.
This signifies the variability in the standard of living among the regions.
The standard deviation is 0.006364, confirming some spread in the GDP per capita among the regions.
However, there are 11 missing values, which might impact the accuracy of the analysis.

Turkey (TR) has a wide range in GDP, reflecting a significant economic diversity between the regions.
GDP varies from a minimum value of 196.8 million Euros to a maximum value of 242,730.0 million Euros, with a mean of 7421 million euros.
The standard variation is large, 21841 million euros.
The median value (2513.5) is lower than the mean, which may indicate that the high maximum GDP might be influenced by outliers.
The population in Turkey varies from 74,412 to 15,067,724 people, indicating a wide spectrum among the regions.
The GDP per capita in Turkey varies widely ranging from a minimum of 0.001581 million euros to a maximum of 0.016721 million euros, with a relatively low mean of 0.0061 million euros.
The standard deviation of 0.002523 million euros is notable, indicating substantial variability in the economic well-being between regions in Turkey.

Finland (FI) have a relatively high regional GDP mean of 9419.13 million euros, with a standard deviation of 15210.64 million euros.
The regions have a population ranging from 25706 to 1671024 people.
Finland have regions with relatively small in population size.
The mean GDP per capita is 0.0312 million euros, reflecting a relatively high average standard of living.
Finland's GDP per capita is notably higher than the other countries, suggesting a high standard of living.
The low standard deviation (0.00708) indicate that, on average, the GDP per capita values do not deviate significantly from the mean.
It is important to note that the country has 20 missing values.

The United Kingdom (UK) mean GDP of 9130 million pounds, suggests a robust overall economic output in the regions.
The minimum value is 320 million ponds and the maximum value is 117,051 million ponds.
The UK have the highest GDP range among the four countries, indicating a large and varied economy.
The population size of the regions varies from 19,220 to 1,195,672 people.
The UK exhibits the highest mean GDP per capita among the studied countries, standing at 0.0261 million pounds.
The standard deviation of 0.0286 indicates a moderate level of variability in GDP per capita.
There might be some significant outliers, as suggested bu the large difference between the maximum value (0.413616) and the 3rd quartile (0.026761).

We will give a short summary of the GDP per capita for the regions within the four countries, because GDP per capita accounts for differences arising from regions of varying sizes.
The United Kingdom stands out with the highest maximum GDP per capita, indicating some regions with very high economic output.
The UK also exhibits the widest range of GDP per capita among regions.
Finland follows the UK with a relatively high overall economic well-being.
The distribution suggest that the standard of living is generally favorable across regions.
The Czech Republic falls in the middle, with a moderate range of GDP per capita, suggesting different levels of economic well-being across regions.
Turkey has the lowest range of GDP per capita.
There is less variation among the regions in Turkey, compared to the other countries.
Turkey have the lowest economic well-being on a person basis.

## Part B: Regional Inequity

The second part focuses on regional inequality.
We will start with a literate review of the subject, then compute population-weighted GDP Gini coefficients for the regions within our subset of European countries.
This includes data presentation through descriptive statistics and visuals.
In the end, we will discuss the computed Gini coefficients and reflect on the implications of our findings in the context of regional inequity.

### Literature Review

Regional inequality refers to the disparities in economic development, income, and other socio-economic indicators among different geographical regions within a country or across countries.
According to @lessmann2017, regional inequality within countries has attracted considerable interest among academics and policy makers in the last decades.
Research on regional inequality is particulary important for the economy.
When certain regions experience higher levels of economic development and prosperity compared to others, it can have far-reaching consequences.
However, in general are the empirical studies on regional inequality limited to a specific country sample with a general bias towards medium and high income economies.
The biggest challenge is obtaining data from the less developed regions in the world.
The poorest regions appear as blank spots on the map.
@lessmann2017 fill this gap by predicting regional incomes using night light data.
Further, they calculated inequality measures, for example population-weighted Gini coefficient, based on these predicted incomes.

We should care about regional inequality because it is essential for both the economy and social welfare in general.
The potential consequences of regional inequality are many.
@lessmann2017 highlights a correlation between regional inequality and personal income inequality, ethnic inequality, and political stability in their study.
Addressing regional imbalances within countries is crucial, as they may independently contribute to economic outcomes and exacerbate issues like income inequality, ethnic tensions, and segregation.

### Gini Coefficient Calculation

Measuring regional inequality is challenging because it is difficult to compare regions of different sizes.
The number of regions by each country also varies in our dataset.
To deal with this issue, we can use a population-weighted Gini coefficient that accounts for different sizes of the regions [@lessmann2017] .

To compute the population-weighted GDP Gini coefficient for each European NUTS 2 level region within the subset of countries, we used the formula below:

$GINW_j=\frac{1}{2\overline y j} \sum_{i}^{n_j} \sum_{l}^{n_j} \frac{p_i}{P_j} \frac{p_l}{P_j} |y_i - y_l|$

First, we created a new dataset (main_data_2) that includes three new variables with NUTS 0, NUTS 2 and NUTS 3 regions.
Then, we calculated the population-weighted GDP gini coefficient for each NUTS 2 level region.

```{r}
# Creating NUTS 2 and NUTS 0 level
main_data_2 <- main_data |>
  mutate(id_nuts3 = geo,
         id_nuts2 = substr(geo, 1,4),
         id_nuts0 = substr(geo, 1, 2)
         )
```

```{r}
# Calculating the population-weighted GDP Gini coefficient for each NUTS 2 level region
main_data_2 <- main_data_2 |>
  filter(pop != "NA") |>
  filter(pop != 0) |>
  filter(gdp_per_capita != "NA") |>
  group_by(id_nuts2, year) |>
  mutate(gini_n2 = gini.wtd(gdp_per_capita, weights = pop)) |>
  ungroup()
```

```{r}
# Cleaning the dataset
main_data_2 <- main_data_2 %>%
  select(year, id_nuts3, id_nuts2, id_nuts0, gdp, pop, gdp_per_capita, gini_n2, -geo)
```

Further, we created main_data_nuts2 that contains only the first row of each group defined by the combination of "id_nuts_2" and "year" from the dataset "main_data 2".

```{r}
main_data_nuts2 <- main_data_2 |>
 group_by(id_nuts2, year) |>
  slice(1)
```

### Data Presentation

We created a table to get a overview of the population-weighted GDP gini coefficient for each country (NUTS 0 regions).

```{r}
# Calculating Gini Coefficient at a NUTS 0 level
gini_nuts0 <- main_data_nuts2 |>
  filter(!is.na(gini_n2)) |>
  group_by(id_nuts0) |>
  summarize(
    Mean = mean(gini_n2),
    Variance = var(gini_n2),
    Max = max(gini_n2),
    Min = min(gini_n2)
  )
```

```{r}
# Table
gini_nuts0 |>
  kable(caption = "Figure 5: Gini Coefficient for the countries")
```

From the table we see that the Czech Republic exhibits relatively low regional inequality.
It has a mean of 0.0131, indicating lowest regional inequality on average among the countries.
The data has low variance (0.0002), suggesting a relatively stable distribution.
The maximum Gini coefficient observed is 0.0353, while the minimum is 0.
This indicates a fairly equitable income distribution within the country.

Finland follows with slightly higher mean and maximum value.
The Gini coefficient has a higher mean value of 0.0282, indicating slightly more regional inequality compared to the Czech Republic.
The variance is also higher (0.0006), suggesting more variability in income distribution.
The maximum Gini coefficient observed is 0.0708, and the minimum is 0.
Finland's income distribution is relatively equitable but slightly more diverse than that of the Czech Republic.

Turkey displays a higher level of regional inequality, with a mean Gini coefficient of 0.0544.
The data exhibits greater variance (0.0015), indicating significant income disparities.
The maximum Gini coefficient observed is 0.1642, emphasizing the presence of considerable regional inequality within the country.
However, the minimum is 0, highlighting the absence of perfectregional equality.

The United Kingdom experiences the highest regional inequality among the studied countries, with a mean Gini coefficient of 0.0917.
The variance is substantial (0.0067), signifying a wide range of income disparities.
The maximum Gini coefficient observed is 0.4925, while there is no recorded minimum (0).
The UK's income distribution is characterized by a significant degree of inequality.

#### Subset 2018 from main_data_nuts2:

We chose to look further at data from year 2018.
Within this subset, we focused on NUTS2 regions in the four countries: Czechia, Turkey, the United Kingdom (UK), and Finland.
Our aim was to explore potential trends in regional inequality, as measured by the Gini coefficient, in relation to the population of these NUTS2 regions.

```{r}
subset_nuts2data <- main_data_nuts2 %>%
  filter(grepl("2018", year))
```

To visualize these trends more effectively for each region, we employed a scatterplot.
In this plot, we assigned different colors to represent the Gini coefficients of each region.
This allowed us to examine and compare how regional inequality may vary concerning population size for each of the mentioned countries.

To create these visualizations, we utilized the ggplot2 library in R, enabling us to analyze and depict the data effectively.

```{r}
# Create the scatterplot
scatter_plot <- ggplot(subset_nuts2data, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")
  
# Add the regression line
scatter_plot <- scatter_plot +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black")

scatter_plot
```

We opted to exclude a specific NUTS2 region within the UK, located in London, due to its unusually high level of inequality, which deviated significantly from the patterns observed in other regions.
This decision was made to ensure a more accurate and representative analysis.
Additionally, we omitted Istanbul from the dataset, primarily because it is significantly larger than any other city in the dataset, and its unique characteristics could potentially skew the overall analysis:\

```{r}
# Create the scatterplot
scatter_plot2 <- ggplot(subset_nuts2data, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region") +
  scale_x_continuous(limits = c(0, 6000000)) +
  scale_y_continuous(limits = c(0, 0.3))  # Set the y-axis limits to 0.3

# Add the regression line
scatter_plot2 <- scatter_plot2 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )

scatter_plot2
```

#### Subset UK from nuts2:

We also created a subset of the 'main_data_nuts2' specifically for the United Kingdom (UK) due to its extensive dataset.
Our objective was to closely examine whether the trend in the Gini coefficient was consistent within the UK, as it was for all the NUTS2 regions across various countries.

```{r}
subset_nuts2data_UK <- main_data_nuts2 %>%
  filter(grepl("^UK", id_nuts2) & year == 2018)
```

To achieve this, we generated a new scatterplot using the 'ggplot()' function.

```{r}
# Create the scatterplot
scatter_plot3 <- ggplot(subset_nuts2data_UK, aes(x = pop, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")  
# Add the regression line
scatter_plot3 <- scatter_plot3 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )
  
scatter_plot3

```

### Discussion

**Economic Performance and GDP per Capita\
**The study uncovers noteworthy variations in economic performance, population diversity, and GDP per capita among the four countries.
Turkey stands out with the most significant economic disparities, indicating a diverse economic landscape.
In contrast, Finland appears to have a relatively stable and more uniform economy.
The United Kingdom boasts a high average GDP per capita; however, it experiences substantial internal variations.
The Czech Republic falls in between, showing moderate economic diversity.
These findings underscore the significance of acknowledging regional disparities and economic heterogeneity within these nations.

**Regional Inequality and Gini Coefficient\
**The Gini coefficient statistics provide valuable insights into the levels of regional inequality across the four countries.
The Czech Republic exhibits the lowest income inequality, reflecting a relatively equitable distribution.
Finland follows closely, indicating slightly more regional inequality but maintaining a reasonably balanced income structure.
Turkey experiences a higher degree of regional inequality, suggesting significant income disparities among its population.
The United Kingdom displays the highest regional inequality among the countries, characterized by a substantial income gap.
These findings shed light on the distribution of wealth and income disparities within these nations.

**Scatterplot Analysis\
**A visual examination of the scatterplots reinforces the observed trends.
Notably, regions within Finland and the Czech Republic demonstrate lower levels of income inequality compared to those in the UK and Turkey.
This suggests a more equitable income distribution in the former countries.
Additionally, a discernible trend is the inverse relationship between population size and income inequality within each nation.
This trend is particularly pronounced in Turkey, implying that larger populations tend to exhibit lower income disparities.

Intriguingly, the scatterplot for the UK presents a unique finding.
In contrast to the collective data for all countries, a slightly higher level of inequality is observed in larger regions within the UK.
This phenomenon might be attributed to the fact that larger cities in the UK often display a wider income gap between affluent and less fortunate residents.
This nuanced observation emphasizes the complexity of income distribution within the United Kingdom.

Overall, this study contributes to a deeper understanding of economic diversity and regional inequality within these four countries, emphasizing the significance of accounting for regional variations and population dynamics in economic analyses.
