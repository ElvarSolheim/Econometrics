---
title: "Assignment_1"
format: html
editor: visual
bibliography: MSB104.bib
---

```{r}
#| label: setup
#| echo: false
#| output: false
#| message: false
library(tidyverse)
library(readxl)
library(magrittr)
library(knitr)
library(dineq)
library(ineq)
library(ggplot2)
library(scales)
library(cowplot)
library(dplyr)
library(huxtable)
library(vtable)
library(future)
library(furrr)
library(lmtest)
library(plm)
```

# Assignment 1: Data and Descriptive

This assignment aims to obtain, process, and analyze sub-national GDP and population data for a subset of European countries.
The selected subset comprises the Czech Republic, Turkey, Finland and the United Kingdom.
The objective is to calculate GDP per capita and explore regional inequity using a range of descriptive statistics and visualizations.

## Part A: Sub-national GDP and GDP per Capita

In the first part, we will dive into sub-national GDP for the selected European countries.
Firstly, a brief overview of the data acquisition will be given.
Furthermore, we will calculate GDP per capita for each sub-region.
Lastly, we will provide a descriptive analysis that gives insights into the distribution and the central tendencies of the data.

### Data Acquisition

The assignment is based on datasets providing sub-regional data on GDP and population from the year 2000 to 2020.
We had to obtain data for the UK in a different way than for the rest of the countries.
We will now take you through the data acquisition.

We obtained data for the EU countries (Czech Republic, Turkey and Finland) from Eurostat.
We downloaded two datasets, one providing GDP data and the other one providing population data.
The NUTS classification is a hierarchical system that enables cross-border statistical comparisons at various regional levels within the EU.
The datasets we downloaded from Eurostat are at a NUTS 3 level.

```{r}
#| echo: false
#| output: false
# GDP data for Czech Republic, Turkey and Finland
gdp_data <- read_csv("nama_10r_3gdp__custom_7667248_linear.csv") |>
  filter(unit == "MIO_EUR") |>
  select(year = TIME_PERIOD, geo, gdp = OBS_VALUE)
```

```{r}
#| echo: false
#| output: false
# Population data for Czech Republic, Turkey and Finland
population_data <- read_csv("demo_r_pjanaggr3__custom_7667383_linear.csv") |>
  select(year = TIME_PERIOD, geo, pop = OBS_VALUE)
```

The UK is not included in the datasets from Eurostat, since the country is no longer a part of the EU.
We got sub-regional GDP and population data for the UK from the Office for National Statistics.
The UK uses another classification system than the EU.
Instead of NUTS regions, they use ITL regions.
These two classification systems work on the same principle and we will from now on, refer to all regions as NUTS.

```{r}
#| echo: false
# GDP data for UK
gdp_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 5", skip = 1)
```

```{r}
#| echo: false
# Population data for UK
population_UK <- read_excel("regionalgrossdomesticproductgdpallitlregions.xlsx", 
    sheet = "Table 6", skip = 1)
```

```{r}
#| echo: false
# Reforming gdp_UK
gdp_UK <- gdp_UK %>%
  gather(year, gdp, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, gdp) %>%
  arrange(geo)
```

```{r}
#| echo: false
# Reforming population_UK
population_UK <- population_UK %>%
  gather(year, pop, -ITL, -`ITL code`, -`Region name`) %>%
  filter(ITL == "ITL3") %>%
  mutate(geo = `ITL code`) %>%
  select(year, geo, pop) %>%
  arrange(geo)
```

When sub-regional GDP and population data for both the EU countries and the UK were downloaded, we merged the EU datasets with the UK datasets to get one main dataset containing sub-regional GDP and population for all the countries.
We named the final dataset for "main_data".

```{r}
#| echo: false
# Merging gdp dataset with population dataset for the EU countries
merged_data <- gdp_data |>
  left_join(population_data, join_by(year,geo))
```

```{r}
#| echo: false
# Merging gdp dataset with population dataset for the UK
merged_UK <- gdp_UK |>
  left_join(population_UK, join_by(year,geo))
merged_UK$geo <- gsub("TL", "UK", merged_UK$geo)
```

```{r}
#| echo: false
# Converting the "year" variable into a character
merged_data$year <- as.character(merged_data$year)
merged_UK$year <- as.character(merged_UK$year)
```

```{r}
#| echo: false
#| output: false
# Merging EU dataset with UK dataset
main_data <- full_join(merged_data, merged_UK)
```

```{r}
#| echo: false
# We only want data from year 2000 to 2020
main_data <- main_data %>%
  subset(main_data$year >= 2000 & main_data$year <= 2020) %>%
  select(year, geo, pop, gdp)
```

```{r}
#| echo: false
# Clean up
rm(gdp_data, population_data, gdp_UK, population_UK, merged_data, merged_UK)
```

### GDP per Capita Calculation

The GDP per capita gives an average representation of the economic well-being of the individuals in the regions, indicating the amount of economic output generated, by each person.

We add a new variable measuring GDP per capita to our main dataset by using the formula:

$y_{i} = \frac{GDP_{i}}{Population_{i}}$

```{r}
#| echo: false
# Adding GDP per capita in the main_data
main_data <- main_data %>%
  mutate(gdp_per_capita = gdp / pop)
```

### Descriptive Analysis

Our dataset includes GDP measured at current market prices in millions of euros for Czech Republic, Turkey, and Finland.
For the United Kingdom, GDP is measured in millions of pounds.
The population variable represents the total annual population within each NUTS 3 region.
Consequently, the GDP per capita variable expresses GDP in millions of euros/pounds per capita in each NUTS 3 region.

Through descriptive statistic we will summarize and describe the main features and key characteristics of the dataset.
We will present a summary of the descriptive statistics for each country.
The summary contains minimum and maximum value, median, mean, quartiles, variance and standard deviation for gdp, population and gdp per capita.

```{r}
#| echo: false
# Create subsets for each country 
data_CZ <- subset(main_data, grepl("^CZ", geo))
data_TR <- subset(main_data, grepl("^TR", geo))
data_FI <- subset(main_data, grepl("^FI", geo))
data_UK <- subset(main_data, grepl("^UK", geo))

# Generate summary statistics for each country
summary_CZ <- summary(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))])
summary_TR <- summary(data_TR[, !(names(data_TR) %in% c("year", "geo"))])
summary_FI <- summary(data_FI[, !(names(data_FI) %in% c("year", "geo"))])
summary_UK <- summary(data_UK[, !(names(data_UK) %in% c("year", "geo"))])

# Calculate variance and standard deviation for each country (excluding NA values)
var_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_CZ <- sapply(data_CZ[, !(names(data_CZ) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_TR <- sapply(data_TR[, !(names(data_TR) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_FI <- sapply(data_FI[, !(names(data_FI) %in% c("year", "geo"))], sd, na.rm = TRUE)

var_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], var, na.rm = TRUE)
sd_UK <- sapply(data_UK[, !(names(data_UK) %in% c("year", "geo"))], sd, na.rm = TRUE)

# Add variance and standard deviation to the summary statistics
summary_CZ <- rbind(summary_CZ, var = var_CZ, sd = sd_CZ)
summary_TR <- rbind(summary_TR, var = var_TR, sd = sd_TR)
summary_FI <- rbind(summary_FI, var = var_FI, sd = sd_FI)
summary_UK <- rbind(summary_UK, var = var_UK, sd = sd_UK)

# Create summary tables for each country
kable(summary_CZ, caption = "Table 1: Summary Statistics for Czech Republic (CZ)")
kable(summary_TR, caption = "Table 2: Summary Statistics for Turkey (TR)")
kable(summary_FI, caption = "Table 3: Summary Statistics for Finland (FI)")
kable(summary_UK, caption = "Table 4: Summary Statistics for United Kingdom (UK)")
```

The Czech Republic's (CZ) regional GDP ranges from a minimum value of 1702 million Euros to a maximum value of 61602 million Euros.
The mean GDP is 10291 million Euros and the standard deviation 9504.78 million euros.
This indicates a moderate overall economic output for the country.
The mean of the population in the NUTS 3 regions within Czech Republic is 748,180 people, with a standard deviation of 320,076.68.
The average GDP per capita is 0.0130 million euros, indicating a moderate level of economic well-being on average among the regions.
The range of GDP per capita in the Czech Republic is from 0.005030 million euros to 0.047073 million euros.
This signifies the variability in the standard of living among the regions.
The standard deviation is 0.006364, confirming some spread in the GDP per capita among the regions.
However, there are 11 missing values, which might impact the accuracy of the analysis.

Turkey (TR) has a wide range in GDP, reflecting a significant economic diversity between the regions.
GDP varies from a minimum value of 196.8 million Euros to a maximum value of 242,730.0 million Euros, with a mean of 7421 million euros.
The standard variation is large, 21841 million euros.
The median value (2513.5) is lower than the mean, which may indicate that the high maximum GDP might be influenced by outliers.
The population in Turkey varies from 74,412 to 15,067,724 people, indicating a wide spectrum among the regions.
The GDP per capita in Turkey varies widely ranging from a minimum of 0.001581 million euros to a maximum of 0.016721 million euros, with a relatively low mean of 0.0061 million euros.
The standard deviation of 0.002523 million euros is notable, indicating substantial variability in the economic well-being between regions in Turkey.

Finland (FI) have a relatively high regional GDP mean of 9419.13 million euros, with a standard deviation of 15210.64 million euros.
The regions have a population ranging from 25706 to 1671024 people.
Finland have regions with relatively small in population size.
The mean GDP per capita is 0.0312 million euros, reflecting a relatively high average standard of living.
Finland's GDP per capita is notably higher than the other countries, suggesting a high standard of living.
The low standard deviation (0.00708) indicate that, on average, the GDP per capita values do not deviate significantly from the mean.
It is important to note that the country has 20 missing values.

The United Kingdom (UK) mean GDP of 9130 million pounds, suggests a robust overall economic output in the regions.
The minimum value is 320 million ponds and the maximum value is 117,051 million ponds.
The UK have the highest GDP range among the four countries, indicating a large and varied economy.
The population size of the regions varies from 19,220 to 1,195,672 people.
The UK exhibits the highest mean GDP per capita among the studied countries, standing at 0.0261 million pounds.
The standard deviation of 0.0286 indicates a moderate level of variability in GDP per capita.
There might be some significant outliers, as suggested bu the large difference between the maximum value (0.413616) and the 3rd quartile (0.026761).

We will give a short summary of the GDP per capita for the regions within the four countries, because GDP per capita accounts for differences arising from regions of varying sizes.
The United Kingdom stands out with the highest maximum GDP per capita, indicating some regions with very high economic output.
The UK also exhibits the widest range of GDP per capita among regions.
Finland follows the UK with a relatively high overall economic well-being.
The distribution suggest that the standard of living is generally favourable across regions.
The Czech Republic falls in the middle, with a moderate range of GDP per capita, suggesting different levels of economic well-being across regions.
Turkey has the lowest range of GDP per capita.
There is less variation among the regions in Turkey, compared to the other countries.
Turkey have the lowest economic well-being on a person basis.

## Part B: Regional Inequity

The second part focuses on regional inequality.
We will start with a literate review of the subject, then compute population-weighted GDP Gini coefficients for the NUTS 2 regions within our subset of European countries.
This includes data presentation through descriptive statistics and visuals.
In the end, we will discuss the computed Gini coefficients and reflect on the implications of our findings in the context of regional inequity.

### Literature Review

Regional inequality refers to the disparities in economic development, income, and other socio-economic indicators among different geographical regions within a country or across countries.
According to @lessmann2017, regional inequality within countries has attracted considerable interest among academics and policy makers in the last decades.
Research on regional inequality is particularly important for the economy.
When certain regions experience higher levels of economic development and prosperity compared to others, it can have far-reaching consequences.
However, in general are the empirical studies on regional inequality limited to a specific country sample with a general bias towards medium and high income economies.
The biggest challenge is obtaining data from the less developed regions in the world.
The poorest regions appear as blank spots on the map.
@lessmann2017 fill this gap by predicting regional incomes using night light data.
Further, they calculated inequality measures, for example population-weighted Gini coefficient, based on these predicted incomes.

We should care about regional inequality because it is essential for both the economy and social welfare in general.
The potential consequences of regional inequality are many.
@lessmann2017 highlights a correlation between regional inequality and personal income inequality, ethnic inequality, and political stability in their study.
Addressing regional imbalances within countries is crucial, as they may independently contribute to economic outcomes and exacerbate issues like income inequality, ethnic tensions, and segregation.

### Gini Coefficient Calculation

Measuring regional inequality is challenging because it is difficult to compare regions of different sizes.
To deal with this issue, we can use a population-weighted Gini coefficient that accounts for different sizes of the regions [@lessmann2017] .

We wanted to compute the population-weighted Gini coefficient for the NUTS 2 level regions in the Czech Republic, Turkey, Finland and the UK.
We created a new dataset containing the NUTS 2 regions and added a variable measuring the population-weighted GDP Gini coefficient for each NUTS 2 region by using the formula:

$GINW_j=\frac{1}{2\overline y j} \sum_{i}^{n_j} \sum_{l}^{n_j} \frac{p_i}{P_j} \frac{p_l}{P_j} |y_i - y_l|$

```{r}
#| echo: false
# Creating a NUTS 0, NUTS 2 and NUTS 3 level
main_data_nuts2 <- main_data |>
  mutate(id_nuts3 = geo,
         id_nuts2 = substr(geo, 1,4),
         id_nuts0 = substr(geo, 1, 2)
         )
```

```{r}
#| echo: false
main_data_nuts2 <- main_data_nuts2 |>
  # Removing NA`s 
  filter(pop != "NA") |>
  filter(pop != 0) |>
  filter(gdp_per_capita != "NA") |>
  group_by(id_nuts2, year) |>
  # Adding Gini coefficient, population, GDP and GDP per capita for the NUTS 2 regions
  mutate(gini_n2 = gini.wtd(gdp_per_capita, weights = pop), 
         pop_n2 = sum(pop),
         gdp_n2 = mean(gdp),
         gdp_per_capita_n2 = mean(gdp_per_capita)
         ) |>
  ungroup()
```

```{r}
#| echo: false
# Selecting only the NUTS 2 variables
main_data_nuts2 <- main_data_nuts2 %>%
   select(year, -geo, -gdp, -pop, -gdp_per_capita, -id_nuts3, id_nuts0, id_nuts2, pop_n2, gdp_n2, gdp_per_capita_n2, gini_n2)
```

```{r}
#| echo: false
# Selecting only the first row of each group 
main_data_nuts2 <- main_data_nuts2 |>
 group_by(id_nuts2, year) |>
  slice(1) 
```

### Data Presentation

We created a table to get a overview of the population-weighted GDP Gini coefficient for each country (NUTS 0 regions).

```{r}
#| echo: false
# Calculating Gini Coefficient at a NUTS 0 level
gini_nuts0 <- main_data_nuts2 |>
  filter(!is.na(gini_n2)) |>
  group_by(id_nuts0) |>
  summarize(
    Mean = mean(gini_n2),
    Variance = var(gini_n2),
    Max = max(gini_n2),
    Min = min(gini_n2)
  ) 
```

```{r}
#| echo: false
# Table
gini_nuts0 |>
  kable(caption = "Table 5: Gini Coefficient for the countries")
```

From the table we see that the Czech Republic exhibits relatively low regional inequality.
It has a mean of 0.0131, indicating lowest regional inequality on average among the countries.
The data has low variance (0.0002), suggesting a relatively stable distribution.
The maximum Gini coefficient observed is 0.0353, while the minimum is 0.
This indicates a fairly equitable income distribution within the country.

Finland follows with slightly higher mean and maximum value.
The Gini coefficient has a higher mean value of 0.0282, indicating slightly more regional inequality compared to the Czech Republic.
The variance is also higher (0.0006), suggesting more variability in income distribution.
The maximum Gini coefficient observed is 0.0708, and the minimum is 0.
Finland's income distribution is relatively equitable but slightly more diverse than that of the Czech Republic.

Turkey displays a higher level of regional inequality, with a mean Gini coefficient of 0.0544.
The data exhibits greater variance (0.0015), indicating significant income disparities.
The maximum Gini coefficient observed is 0.1642, emphasizing the presence of considerable regional inequality within the country.
However, the minimum is 0, highlighting the absence of perfectregional equality.

The United Kingdom experiences the highest regional inequality among the studied countries, with a mean Gini coefficient of 0.0917.
The variance is substantial (0.0067), signifying a wide range of income disparities.
The maximum Gini coefficient observed is 0.4925, while there is no recorded minimum (0).
The UK's income distribution is characterized by a significant degree of inequality.

#### Subset 2018 from main_data_nuts2:

We chose to look further at data from year 2018.
Within this subset, we focused on NUTS2 regions in the four countries: Czechia, Turkey, the United Kingdom (UK), and Finland.
Our aim was to explore potential trends in regional inequality, as measured by the Gini coefficient, in relation to the population of these NUTS2 regions.

```{r}
#| echo: false
subset_nuts2data <- main_data_nuts2 %>%
  filter(grepl("2018", year))
```

To visualize these trends more effectively for each region, we employed a scatterplot.
In this plot, we assigned different colors to represent the Gini coefficients of each region.
This allowed us to examine and compare how regional inequality may vary concerning population size for each of the mentioned countries.

To create these visualizations, we utilized the ggplot2 library in R, enabling us to analyze and depict the data effectively.

```{r}
#| echo: false
# Create the scatterplot
scatter_plot <- ggplot(subset_nuts2data, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")
  
# Add the regression line
scatter_plot <- scatter_plot +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black")

scatter_plot
```

We opted to exclude a specific NUTS2 region within the UK, located in London, due to its unusually high level of inequality, which deviated significantly from the patterns observed in other regions.
This decision was made to ensure a more accurate and representative analysis.
Additionally, we omitted Istanbul from the dataset, primarily because it is significantly larger than any other city in the dataset, and its unique characteristics could potentially skew the overall analysis:\

```{r}
#| echo: false
# Create the scatterplot
scatter_plot2 <- ggplot(subset_nuts2data, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region") +
  scale_x_continuous(limits = c(0, 6000000)) +
  scale_y_continuous(limits = c(0, 0.3))  # Set the y-axis limits to 0.3

# Add the regression line
scatter_plot2 <- scatter_plot2 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )

scatter_plot2
```

#### Subset UK from nuts2:

We also created a subset of the 'main_data_nuts2' specifically for the United Kingdom (UK) due to its extensive dataset.
Our objective was to closely examine whether the trend in the Gini coefficient was consistent within the UK, as it was for all the NUTS2 regions across various countries.

```{r}
#| echo: false
subset_nuts2data_UK <- main_data_nuts2 %>%
  filter(grepl("^UK", id_nuts2) & year == 2018)
```

To achieve this, we generated a new scatterplot using the 'ggplot()' function.

```{r}
#| echo: false
# Create the scatterplot
scatter_plot3 <- ggplot(subset_nuts2data_UK, aes(x = pop_n2, y = gini_n2, color = id_nuts2)) +
  geom_point() +
  labs(x = "Population", y = "Gini Coefficient", color = "NUTS2 Region")  
# Add the regression line
scatter_plot3 <- scatter_plot3 +
  geom_smooth(
    method = "lm",
    se = FALSE,
    linetype = "dashed",
    color = "black"
  )
  
scatter_plot3

```

### Discussion

**Economic Performance and GDP per Capita\
**The study uncovers noteworthy variations in economic performance, population diversity, and GDP per capita among the four countries.
Turkey stands out with the most significant economic disparities, indicating a diverse economic landscape.
In contrast, Finland appears to have a relatively stable and more uniform economy.
The United Kingdom boasts a high average GDP per capita; however, it experiences substantial internal variations.
The Czech Republic falls in between, showing moderate economic diversity.
These findings underscore the significance of acknowledging regional disparities and economic heterogeneity within these nations.

**Regional Inequality and Gini Coefficient\
**The Gini coefficient statistics provide valuable insights into the levels of regional inequality across the four countries.
The Czech Republic exhibits the lowest income inequality, reflecting a relatively equitable distribution.
Finland follows closely, indicating slightly more regional inequality but maintaining a reasonably balanced income structure.
Turkey experiences a higher degree of regional inequality, suggesting significant income disparities among its population.
The United Kingdom displays the highest regional inequality among the countries, characterized by a substantial income gap.
These findings shed light on the distribution of wealth and income disparities within these nations.

**Scatterplot Analysis\
**A visual examination of the scatterplots reinforces the observed trends.
Notably, regions within Finland and the Czech Republic demonstrate lower levels of income inequality compared to those in the UK and Turkey.
This suggests a more equitable income distribution in the former countries.
Additionally, a discernible trend is the inverse relationship between population size and income inequality within each nation.
This trend is particularly pronounced in Turkey, implying that larger populations tend to exhibit lower income disparities.

Intriguingly, the scatterplot for the UK presents a unique finding.
In contrast to the collective data for all countries, a slightly higher level of inequality is observed in larger regions within the UK.
This phenomenon might be attributed to the fact that larger cities in the UK often display a wider income gap between affluent and less fortunate residents.
This nuanced observation emphasizes the complexity of income distribution within the United Kingdom.

Overall, this study contributes to a deeper understanding of economic diversity and regional inequality within these four countries, emphasizing the significance of accounting for regional variations and population dynamics in economic analyses.

# Assignment 2: Cross-Sectional Estimates

The objective of this assignment is to explore the relationship between regional development and inequality by utilizing cross-sectional estimation techniques, focusing on NUTS 2 data from the year 2010.

## Part A: Growth and Inequity

In the first part, we will dive into growth and inequity.
First, we will estimate three simple linear regression models looking at the relationship between regional development and regional inequality.
Further, we will define our model specifications, justify variable selection, and explain the expected relationship.
Then, we will assess the goodness of fit and discuss the reliability and validity of the estimated models.
We will also discuss if the classical OLS assumptions hold.
Lastly, we will visualize our models with a fitted regression line.

### Model Estimation

To see how regional development affects regional inequality we will estimate three simple linear regression models with the population-weighted GDP Gini coefficient ($GINIW_j$) as the dependent variable and the GDP per capita ($y_j$ ) as the independent variable.
The population-weighted GDP Gini coefficient is chosen for measuring regional inequality, because it gives a nuanced view of regional inequality considering both GDP disparities and the population size in each region.
GDP per capita is a good measure for assessing regional development, because it provides an indicator of the overall living standard in each region.
For the estimation we will use a subset including only observations on NUTS 2 regions from the year 2010.
We will estimate three models for a better insight into how the relationship between regional inequality and regional development is in the different countries.
The first model include data from all our countries, the second model focuses only on EU countries, while the third model is all about the UK.
We dedicate a separate model to the UK, since this country accounts for almost half of the observations.
Below is the equation for our simple linear regression models:

$\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010}$

Based on @lessmann2017 study, we expect the relationship between regional development and regional inequality to follow a pattern similar to a N-shape.
By examining changes in inequality over time, @lessmann2017 found that the majority of all countries experience sigma convergence, which means that regional inequality decreases over time.
However, they found that some poor and lower-middle-income countries, along with some rich economies, show divergence.
This shows that very poor countries exhibit increasing inequalities, while most middle- and high-income countries show decreasing or stabilizing inequalities.
Interestingly, regional inequalities increase again in the richest countries, forming the right side of the N-shaped pattern [@lessmann2017].\

```{r}
#| echo: false
# Subset including nuts2 regions in 2010
subset_nuts2_2010 <- main_data_nuts2 |>
  filter(grepl("2010", year))
```

```{r}
#| echo: false
# Estimate for all the countries
lm1 <- lm(gini_n2 ~ I(gdp_per_capita_n2 * 100) , data = subset_nuts2_2010)

# Estimate for the UK
lm2 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 == "UK") %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)

# Estimate for the EU countries
lm3 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)

# Generate regression table
huxreg(
  list("Model 1 All Countries" = lm1, "Model 2 UK" = lm2, "Model 3 EU" = lm3),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "I(gdp_per_capita_n2 * 100)", Constant = "(Intercept)"),
  stars = c(`***` = 0.01, `**` = 0.05, `*` = 0.10)
  )
```

The regression table reveals a positive relationship between regional development and regional inequality in both Model 1 and Model 2.
In Model 1, including all the countries, a one-unit increase in GDP per capita corresponds to an average rise of 0.026 in the Gini coefficient.
Model 2, focused on the UK, strengthens this association, indicating a slightly higher increase of 0.032 in the Gini coefficient with a rise in GDP per capita.
However, for the EU countries in Model 3, the relationship between regional development and regional inequality is negative.
Here, a one-unit increase in GDP per capita is linked to a 0.012 decrease in the Gini coefficient, suggesting that higher regional development in these countries is paradoxically associated with lower regional inequality.

### Model Diagnostics

We will take a look at how well the regression models fit the observed data by assessing the goodness of fit, discuss the reliability and validity of the models and see if the classic OLS-assumptions hold.

**Goodness of fit**\
We examine the goodness of fit by looking at the R-squared.
The R-squared values indicate the proportion of variation in regional inequality (Gini coefficient) that can be explained by regional development (GDP per capita) in each model.
The closer R-squared is to 1, the better the model is at explaining the variability.
The first model have a R-squared of 0.418, indicating that about 41.8% of the variability in the population-weighted Gini coefficient can be explained by the variation in GDP per capita.
In the second model, a higher R-squared of 0.602 suggest that the GDP per capita variable in this model does a better job of explaining the variability in regional inequality.
The third model has the lowest R-squared among the three models.
In the third model, the R-squared is 0.131, indicating that only 13.1% of the variability is explained.
This model seems to be less effective in capturing the relationship between regional development and regional inequality compared to the other models.

**Reliability and validity**\
Reliability is reflected in the precision of coefficient estimates.
Smaller standard errors indicate more reliable estimates.
All three models show relatively small standard errors, suggesting reasonable reliability in estimating the coefficients.
In Model 1 the standard error for the coefficient of GDP per capita is 0.003.
The standard error is 0.004 for model 2 and 0.005 for model 3.
Larger standard errors suggest less precision in the estimates, meaning there's more uncertainty about the true population values of the coefficients in those models.
We should also look at the R-squared values when assessing reliability.
Higher R-squared values suggest a better reliability in explaining variance.
Model 2 has the highest R-squared, indicating that it explains a larger proportion of the variance compared to the other models.
A lower R-squared suggests that Model 3 has less explanatory power compared to Models 1 and 2.
Only 13.1% of the variation in the dependent variable is captured by the variables included in this model.
It indicates that there might be other factors influencing the dependent variable that are not accounted for in Model 3.

Statistical significance, as indicated by star symbols and p-values, plays a cruical role in assessing the validity of the models.
A low P-value suggests that the predictor variable is likely a valid predictor of the response variable.
In our regression table, all coefficients demonstrate statistical significance, supporting the validity of the models.
The coefficients for "GDP_per_capita" in model 1 and model 2 exhibit extremely low p-values (\<0.01), signifying high significance at a 1% significance level.
Model 3, on the other hand, have a p-value of less than 0.05, indicating a significance at a 5% level.
Regarding the constant terms, model 3 stands out with a significance level of 1% (p \< 0.01).
This reinforces the reliability of Model 3, even though it has the lowest R-squared value.

\
In summary, Model 2, boasting the highest R-squared value and statistically significant coefficient, appears to be the most reliable and valid among the three models.
Model 3, despite its lower R-squared value, still holds significance, especially with the constant term being the only one with a 1% significance level.

**OLS assumptions**\
The classical Ordinary Least Squares (OLS) assumptions are crucial for the validity of the regression results.
Lets see if these assumptions hold.

1.  **Linearity:** The linearity assumption posits that the relationship between the dependent variable $\hat{GINIW_{2010}}$ and the independent variable $y_{2010}$ is linear in parameters.This assumption is met because we specify a linear equation for our regression: $\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010}$.

2.  **Sample Variation:** This assumption necessitates that there is variation in the independent variables within our sample.
    Our independent variable "GDP_per_capita" exhibits variation as it evident from its coefficients in all three models.

3.  **Random Sampling:** The data used to estimate the regression models is obtained from Eurostat and the Office for National Statistics.
    This data are not random samples in the traditional statistical sense, since these organizations collect data from the entire population rather than a randomly selected sample.
    We don\`t have a truly random sample, but it could still be suitable for regression analysis as long as we aware of the potential biases.

4.  **Exogeneity:** The exogeneity assumption suggests that for any value of the independent variable, the mean of the error term is zero ($E(u|X) = 0$).
    The assumption holds if GDP per capita is not correlated with unobserved factors affecting the Gini coefficient.
    This may be the case, but we claim that the exogeneity assumption is fulfilled in our estimations.

5.  **Homoskedasticity:** Homoskedasticity implies that the error term's variance is constant across different values of the independent variable.
    It ensures that the spread of residuals is consistent.
    In our models, homoskedasticity appears to be violated in some cases, as indicated by the increasing standard errors ("constant" term in Model 1 and Model 3).
    This suggests that the spread of residuals may not be constant across all values of the independent variables.
    We test for homoskedasticity using a Breusch-Pagan test.

    ```{r}
    #| echo: false
    # Breusch-Pagan test for Model 1
    lm1_test <- lmtest::bptest(lm1)
    print(lm1_test)

    # Breusch-Pagan test for Model 2
    lm2_test <- lmtest::bptest(lm2)
    print(lm2_test)

    # Breusch-Pagan test for Model 3
    lm3_test <- lmtest::bptest(lm3)
    print(lm3_test)

    ```

    Model 1 shows evidence of heteroskedasticity, while Model 2 and Model 3 do not exhibit significant departures from homoskedasticity.

6.  **Normality:** The normality assumption states that the error term follows a normal distribution with a mean of zero and a constant variance ($\sigma^2$).
    We test normality with three Q-Q plots, one for each of the estimation models.

    ```{r}
    #| echo: false
    # Q-Q plot for Model 1
    qqnorm(residuals(lm1))
    qqline(residuals(lm1))

    # Q-Q plot for Model 2
    qqnorm(residuals(lm2))
    qqline(residuals(lm2))

    # Q-Q plot for Model 3
    qqnorm(residuals(lm3))
    qqline(residuals(lm3))
    ```

The points in each plot follow a straight line, suggesting that the residuals are approximately normally distributed.
Model 1 exhibits the best fit to the line, followed by Model 2 and then Model 3, indicating that the residuals in Model 1 adhere more closely to a normal distribution than those in the other models.

### Visualization

We will visualize the relationship between regional development and regional inequality, incorporating the fitted regression line in three different plots, one for each estimation.

```{r}
#| echo: false
# Plot for all countries
plot_all <- subset_nuts2_2010 %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for All Countries",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 region")

plot_all
```

The figure visualize the relationship between regional development and regional inequality for NUTS 2 regions in the year 2010 for all the countries.
The figure have GDP per capita on the x-axis and Gini coefficient on the y-axis.
The black line represent the estimated relationship.
The figure shows a positive relationship between regional development and regional inequality.

```{r}
#| echo: false
# Plot for the UK
plot_UK <- subset_nuts2_2010 %>%
  filter(id_nuts0 == "UK") %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for the UK",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions") 

plot_UK
```

This visualization illustrates the connection between regional development and inequality within NUTS 2 regions for the UK in the year 2010.
Plotted with GDP per capita on the x-axis and the Gini coefficient on the y-axis, the black line signifies the estimated relationship between these two variables.
The line confirms a positive relationship.

```{r}
#| echo: false
# Plot for the EU countries
plot_EU <- subset_nuts2_2010 %>%
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>%
  ggplot(aes(x = I(gdp_per_capita_n2 * 100), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Regression Model for EU Countries",
       x = "GDP per Capita",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions")

plot_EU
```

The figure visualize the relationship between regional development and regional inequality for NUTS 2 regions in the year 2010 for the EU countries.
With GDP per capita on the x-axis and Gini coefficient on the y-axis, the black line serves the estimated relationship between these two.
We can see from the figure that the relationship is negative.

## Part B: Exploring Other Determinants of Inequity

In the second part, we will explore three other potential determinants that we hypothesize may influence regional inequity.
First, an explanation of the data acquisition will be given.
Further, we will estimate a multiple linear regression model incorporating the newly selected variables alongside regional development, with regional inequality.
Then, we will define our model specifications and clarify why we expect the selected variables to influence regional inequality.
Lastly, we will interpret the estimated coefficients, reflect on the overall fit of the model, and discuss the contribution of each variable to explaining variations in regional inequality.

### Data Acquisition

We will take a look at three potential determinants of regional inequality for the year 2010 for the nuts 2 regions in Tureky.
We hypothesize that unemployment, infrastructure and life expectancy to influence regional inequality in Turkey.
We believe these three can have an impact on regional inequality because:

High unemployment rates can contribute to regional inequality.
We include unemployment as a variable to assess its impact on inequality.
Higher unemployment rates might lead to increased inequality due to income disparities.
Infrastructure, such as transportation and communication networks, is essential for economic development and reducing regional inequality.
Regions with better infrastructure may experience lower levels of inequality.
Life expectancy can be an indicator of the overall well-being of a region.
Regions with higher life expectancies may have better healthcare and social support systems, potentially reducing inequality.

We retrieved data for these potential determinants from Eurostat.

```{r}
#| echo: false
#| output: false
# Data aquisition: Unemployment (per thousand persons) for Turkey
unemployment <- read_csv("lfst_r_lfu3pers__custom_8264488_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, unemployment = OBS_VALUE)
```

```{r}
#| echo: false
#| output: false
# Data aquisition: Road, rail and inland waterways (km pr thousand square) for Turkey
infrastructure <- read_csv("tran_r_net__custom_8264840_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, infrastructure = OBS_VALUE)
```

```{r}
#| echo: false
#| output: false
# Data aquisition: Life expenctancy (years) for Turkey
life_expectancy <- read_csv("demo_r_mlifexp__custom_8282936_linear.csv") |>
  select(id_nuts2 = geo, year = TIME_PERIOD, life_expectancy = OBS_VALUE)
```

```{r}
#| echo: false
# Join unemployment, infrastructure and life expenctancy datasets
determinants_1 <- unemployment |>
  left_join(infrastructure, join_by(year, id_nuts2))

determinants_2 <- determinants_1 |>
  left_join(life_expectancy, join_by(year, id_nuts2)) |>
  select(year, id_nuts2, unemployment, infrastructure, life_expectancy)
```

```{r}
#| echo: false
# Converting the "year" variable into a character
subset_nuts2_2010$year <- as.character(subset_nuts2_2010$year)
determinants_2$year <- as.character(determinants_2$year)

# Join dataset with determinants with subset_nuts2_2010
TR_nuts2_2010 <- subset_nuts2_2010 |>
  filter(id_nuts0 == "TR", year == "2010") |>
  left_join(determinants_2, join_by(year, id_nuts2))
```

### Multiple Linear Regression Model

We will now estimate a multiple linear regression model incorporating the newly selected variables unemployment, infrastructure and life expectancy alongside regional development, with regional inequality for NUTS 2 regions in Turkey for the year 2010.

With the population-weighted GDP Gini coefficient ($GINIW_j$) as the dependent variable and the GDP per capita ($y_j$ ), unemployment, life expectancy and infrastructure as the independent variables.

$\hat{GINIW_{2010}} = \hat{\beta}_0 + \hat{\beta}_1 y_{2010} +\hat{\beta}_2 X_{2010} +\hat{\beta}_3 X_{2010} + \hat{\beta}_4 X_{2010}$

```{r}
#| echo: false

ML_regressionmodel <- TR_nuts2_2010

# Multiple linear regression model

model <- lm(gini_n2 ~ I(gdp_per_capita_n2 * 100) + I(unemployment * 100) + I(infrastructure * 100) + I(life_expectancy * 100), data = ML_regressionmodel)

# R-squared (R²) value
r_squared <- summary(model)$r.squared

# Number of observations (nobs)
num_observations <- summary(model)$nobs

# View the summary of the regression
summary(model)
```

### Model Interpretation

**Residuals**\
The residuals represent the differences between the observed values of gini_n2 and the predicted values from the regression model.
The statistics provide insights into how well the model fits the data.

The minimum residual is approximately -0.04744, indicating the smallest underprediction by the model.When it comes to the first Quartile, about 25% of the residuals fall below -0.02787, suggesting that the model typically underpredicts by this amount.The median residual is -0.00551, indicating that half of the residuals are above and half are below this value.The third Quartile shows that about 75% of the residuals are below 0.02146, showing that the model generally underpredicts.The maximum residual is approximately 0.09078, representing the largest overprediction by the model.

**Coefficients**\
This section provides the estimated coefficients for each independent variable and the intercept (constant term).
The coefficients represent the relationships between the independent variables and the dependent variable gini_n2.
Here's an explanation of each coefficient:

The intercept, approximately 0.3101, is the estimated value of gini_n2 when all independent variables are zero.
The coefficient for gdp_per_capita_n2, approximately 0.003383, indicates that for every 1% increase in gdp_per_capita_n2, gini_n2 is expected to increase by this amount.The coefficient for unemplyment approximately -7.72e-07, suggests that a 1% increase in unemployment is associated with a decrease in gini_n2 by this amount.
The coefficient for infrastructure, approximately -6.002e-06, indicates that a 1% increase in infrastructure is associated with a decrease in gini_n2 by this amount.
The coefficient for life_expectancy, approximately -3.253e-05, suggests that a 1% increase in life expectancy is linked to a decrease in gini_n2 by this amount.

**Standard error\
**The standard error associated with each coefficient measures the precision of the estimate.
Smaller standard errors indicate more precise estimates.
The t-value is the ratio of the estimate to the standard error.
It's used to test the significance of each coefficient.
A t-value close to zero suggests that the variable may not be statistically significant.
The Pr(\>\|t\|) (p-value) indicates the probability of observing such a t-statistic, assuming the null hypothesis that the coefficient is zero.
Smaller p-values (typically below 0.05) suggest that the coefficients are statistically significant.
The resiudual standard error, approximately 0.03516, represents the standard deviation of the residuals.
It measures the average magnitude of the prediction errors.

**Multiple R-squared\
**The multiple R-squared value of 0.1497 represents the proportion of the variation in gini_n2 that can be explained by the independent variables in the model.
In this case, about 14.97% of the variability in gini_n2 is explained by the model, while the rest remains unexplained.

**Adjusted R-squared**\
The adjusted R-squared adjusts the multiple R-squared for the number of independent variables in the model.
In this case, it's approximately 0.0773, indicating the proportion of the variation that the model explains while accounting for the complexity of the model.

**F-statistic and p-value\
**The F-statistic tests the overall significance of the model.
A higher F-statistic indicates a more significant model.
In this case, the F-statistic is 2.068, and it is tested with 4 and 47 degrees of freedom.

The p-value associated with the F-statistic (0.1001) indicates the probability of observing an F-statistic as extreme as the one you have under the null hypothesis, which is that the model has no explanatory power.
In this case, the p-value is relatively high, suggesting that the model may not be statistically significant at conventional significance levels (e.g., 0.05).

In summary, our regression model attempts to explain regional inequality using several economic and social indicators.
The low R-squared and relatively high p-value for the F-statistic suggest that the model may not be a good fit for the data, and the individual coefficients provide insights into how each independent variable affects regional inequality.

# Assignment 3: Alternative Functional Forms and Panel Estimation

In this assignment, we will explore alternative functional forms and implementing panel estimates to analyze the relationship between regional development and inequality.

## Part A: Testing Development Effects Across Subsets

In the first part, we will test development effects across subsets.
First, we will estimate the effect of regional development on inequality within each subset and test if the effects significantly differ.
Then, we will interpret and discuss the results, focusing on differences in development effects across subsets.

### Subset Analysis

We have already tested the development effects using one estimate for all countries, another estimate for the UK and one estimate specifically for the EU countries.
Now, we will take a closer look at the EU countries.
This subset analysis includes three subsets, each corresponding to one of our EU countries (Czech Republic, Finland and Turkey).
Within these subsets, we will estimate the impact of regional development on inequality within the respective nuts2 regions for each country in year 2010.

```{r}
#| echo: false
# Estimate for Czech Republic
lm4 <- subset_nuts2_2010 %>%
  filter(id_nuts0 == "CZ") %>%
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100) 
     , data = .)

# Estimate for Finland
lm5 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 == "FI") %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100),
     data = .)

# Estimate for Turkey
lm6 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 == "TR") %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100),
     data = .)
```

```{r}
#| echo: false
# Regression table
huxreg(
  list("Model 1 - CZ" = lm4, "Model 2 - FI" = lm5, "Model 3 - TR" = lm6),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "I(gdp_per_capita_n2 * 100)", Constant = "(Intercept)"),
  stars = c(`***` = 0.01, `**` = 0.05, `*` = 0.10)
  )
```

### Subset Analysis Discussion

The regression table reveal a consistent negative relationship between regional inequality (Gini coefficient) and regional development (GDP per capita) across Czech Republic, Finland, and Turkey.
This negative relationship suggests that, in these EU countries, higher levels of regional development are associated with lower levels of inequality.
Examining the "GDP per capita" coefficients for the EU countries, we observe that for the Czech Republic, the estimated decrease in regional inequality is 0.008 for a one-unit increase in GDP per capita.
Finland exhibits a larger effect, with a coefficient of 0.026, indicating a larger reduction in regional inequality for the same increase in regional development.
Turkey demonstrates the largest impact, with a coefficient of 0.041.
Both Model 1 and Model 2 have relatively small standard error for the coefficient of GDP per capita.
Model 1 have a standard error of 0.006 and Model 2 have a standard error of 0.009.
Model 3 have a larger standard error at 0.029, suggesting less precision in the estimate.
Model 1 and Model 3 for Czech Republic and Turkey does not show a statistically significant relationship for GDP per capita, as the p-value is greater than 0.10.
Model 2 for Finland reveals a statistically significant relationship for GDP per capita at the 10% significance level (p \< 0.1).

The constant term indicate the estimated value of the Gini coefficient, when GDP per capita is zero.
However, setting GDP per capita to zero may not have a meaningful interpretation as GDP per capita is typically a positive value.
All of the constant terms are significant, Model 1 and Model 2 at a 5% significance level, and Model 3 at a 1% significance level.

Model 2 has the highest R-squared value (0.757), indicating that it explains a substantial amount of the variation in regional inequality for Finland compared to the other models.
The Czech Republic follows with a R-squared values of 0.223, indicating that the model explains 22.3% of the variance in the Gini coefficient.
Turkey has the lowest R-squared Value of 0.077, suggesting that the model may not fit the data as well in Turkey as the other countries.

It is noteworthy that the number of observations differ across the countries, with the Czech Republic having the smallest sample size (8 observations), followed by Finland ( 5 observations), and Turkey with the largest sample size (26 observations).
Smaller number of observations in the Czech Republic and Finland might introduce some caution regarding the robustness of the estimates.

## Part B: Exploring Alternative Functional Forms

The second part involves exploring alternative functional forms.
We will estimate alternative models and visualize them.
Further, we will discuss the results and the fit of the alternative models compared to the original linear model.

### Functional Form Exploration

We will explore functional forms for the EU countries and the UK.
Since the number of observations for each of the EU-countries are small, we will stick to the previous model with all the EU countries together.

The logarithmic form suits models where diminishing returns or asymptotic behaviour is expected.
In our simple linear regression model for the EU countries we have a negative relationship where higher levels of regional development are associated with lower levels of inequality.
We will therefore estimate and visualize a logarithmic model for the EU countries.

In the plot of our simple linear regression model for the UK we see that the data to some extent displays a inverted U-shaped pattern.
The quadratic function is used in situations where there is a curvature relationship between variables.
Based on this, we think a quadratic from is suitable for the UK.\

### Estimation and Visualization

We will estimate and visualize one logarithmic model for the EU countries and one quadratic model for the UK.

```{r}
#| echo: false
# Logarithmic model for EU countries
lm_log_EU <- lm(gini_n2 ~ log(gdp_per_capita_n2 * 100), data = subset_nuts2_2010 %>% filter(id_nuts0 %in% c("CZ", "FI", "TR")))

huxreg(
  list("Model 1 - EU" = lm_log_EU),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "log(gdp_per_capita_n2 * 100)", Constant = "(Intercept)"),
  stars = c(`***` = 0.01, `**` = 0.05, `*` = 0.10)
  )
```

Table X displays the regression table for the logarithimc model for the EU.
The GDP per capita coefficient is -0.020.
This negative relationship implies that when the logarithm of GDP per capita increases by one unit, the Gini coefficient decreases by 0.020.
This coefficient is significant at a 5% significance level with a standard error of 0.008.
The constant term for the logarithmic model is 0.038, with a standard error of 0.005.
The constant term is highly significant at a 1% significance level.
The R-squared value of 0.164 indicates that the model explains about 16.4% of the variance in the Gini coefficient.\

```{r}
#| echo: false
# Plot for the EU countries
plot_EU_log <- subset_nuts2_2010 %>%
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>%
  ggplot(aes(x = (log(gdp_per_capita_n2 * 100)), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Logarithmic Regression Model for EU Countries",
       x = "Log(GDP per Capita)",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions")
plot_EU_log
```

The logaritmic model for the EU countries is visualizsed in figure X, with the logarithm of GDP per capita on the x-axis and the GDP Gini coefficient on the y-axis.

```{r}
#| echo: false
# Quadratic model for the UK
lm_quad_UK <- lm(gini_n2 ~ I((gdp_per_capita_n2 * 100)^2), data = subset_nuts2_2010 %>% filter(id_nuts0 == "UK"))

huxreg(
  list("Model 1 - UK" = lm_quad_UK),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "I((gdp_per_capita_n2 * 100)^2)", Constant = "(Intercept)"),
  stars = c(`***` = 0.01, `**` = 0.05, `*` = 0.10)
  )
```

Table X displays the regression table for the quadratic model for the UK.
The quadratic model have a positive GDP per capita coefficient of 0.002.
This positive value suggest an inverted U-curve in the relationship between GDP per capita and the Gini coefficient in the UK, with a turning point where the impact of GDP per capita on regional inequality start to diminish instead of increase.
This relationship is highly significant at a 1% significance level.
The quadratic model have a constant of 0.073 which also is significant at a 1% significance level, with a standard error of 0.010.
The R-squared value of 0.570 indicates that the model explains about 57% of the variance in the Gini coefficient.

```{r}
#| echo: false
# Plot for the UK
plot_UK_quad <- subset_nuts2_2010 %>%
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>%
  ggplot(aes(x = I((gdp_per_capita_n2 * 100)^2), y = gini_n2, color = id_nuts2)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed", color = "black") +
  labs(title = "Quadratic Regression Model for UK",
       x = "GDP per Capita^2",
       y = "GDP Gini Coefficient",
       color = "NUTS2 Regions")
plot_UK_quad
```

The quadratic model is visualized in figure X, with the square of GDP per capita on the x-axis, and the GDP Gini coefficient on the y-axis.

### Results Interpretation

**The logarithmic model vs. the linear model for the EU countries**\
Both the logarithmic and linear model of the EU countries show a negative coefficient for GDP per capita, suggesting a negative relationship between regional development and inequality.
The logarithmic model has a larger negative coefficient for GDP per capita, indicating a steeper decline in the effect of GDP per capita.
The R-squared value of the logarithmic value is 0.164.
The linear model have a R-squared value of 0.131.
The logarihmic model have a slightly better fit compared to the linear model.

**The quadratic model vs. the linear model for the UK**\
The quadratic model and the linear model shows a positive relationship between regional development and inequality.
The linear model suggests a stronger positve relationship between GDP per capita and the Gini coefficient in the UK compared to the quadratic model.
The quadratic model introduces a non-linear term, but the linear model still has a bettet fit based on the R-squared value.
The R-squared value in the quadratic model is 0.570 and in the linear model it is 0.602.
The quadratic model captures a potential curvature in the relationship, but the linear model provide a better overall fit for the UK based on the higher R-squared value.\

## Part C: Heteroskedasticity Testing and Causality Discussion

In the third part, we will test for heteroskedasticity in the alternative and original models.
We will also reflect on the causal interpretation of the models and suggest strategies to address any issues identified.

### Heteroskedasticity Testing

To test for heteroskedasticity in the alternative and linear models we will use Breusch-Pagan tests.
The null hypothesis is homoskedasticity and the alternative hypothesis is heteroskedasticity.
If the p-value is less than the significance level, we will reject the null hypothesis and conclude that there is evidence of heteroskedasticity.

**Linear models**

First, we will test for heteroskedsticity in the linear models.

```{r}
#| echo: false
# Estimate for the UK
lm2 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 == "UK") %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)
# Breusch-Pagan test F-Test
p_UK <- bptest(lm2)
p_UK
```

```{r}
#| echo: false
# Estimate for the EU Countries
lm3 <- subset_nuts2_2010 %>% 
  filter(id_nuts0 %in% c("CZ", "FI", "TR")) %>% 
  lm(gini_n2 ~ I(gdp_per_capita_n2 * 100), data = .)
# Breusch-Pagan test F-Test
p_EU <- bptest(lm3)
p_EU
```

From the Breuch-Pagan test for the linear model for the UK we see that the p-value is 0.7716.
The p-value is 0.3068 for the linear model of the EU countries.
The p-values from the Breusch-Pagan test suggest that we do not have enough evidence to reject the null hypothesis of homoskedasticity for both the UK and the EU linear models.
Since we fail to reject the null hypotesis, the variance of the residuals is reasonably constant across different levels of GDP per capita for both the linear models.
This gives reliability of our coefficient estimates and the validity of our statistical inferences.

**\
Alternative models**

We will now test for hetroskedasticity for the alternative models.

```{r}
#| echo: false
# Quadratic model for the UK
lm_quad_UK <- lm(gini_n2 ~ I((gdp_per_capita_n2 * 100)^2), data = subset_nuts2_2010 %>% filter(id_nuts0 == "UK"))
# Breusch-Pagan test F-Test
p_UK_2 <- bptest(lm_quad_UK)
p_UK_2
```

```{r}
#| echo: false
# Logarithmic model for EU countries
lm_log_EU <- lm(gini_n2 ~ log(gdp_per_capita_n2 * 100), data = subset_nuts2_2010 %>% filter(id_nuts0 %in% c("CZ", "FI", "TR")))
# Breusch-Pagan test F-Test
p_EU_2 <- bptest(lm_log_EU)
p_EU_2
```

The p-value for the logarithmic model for the EU countries is 0.5477.
The p-value is 0.8687 for the quadratic model of the UK.
The p-values from the Breusch-Pagan test for both the quadratic model for the UK and the logarithmic model for the EU are higher than conventional significance levels.
This suggests that, similar to the linear models, there is not enough evidence to reject the null hypothesis of homoskedsticity for these alternative models.
The results indicate that the variance of the residuals is reasonably constant across different levels of GDP per capita for both the alternative models.
This is reassuring for the reliability and validity of the models.\

### Causality Discussion

## Part D: Panel Estimates

In part D, we conduct panel estimates using the entire dataset, examining the impact of regional development on regional inequality.
We use various panel estimation techniques, incorporating different fixed effects - both separately and jointly.
We interpret the panel estimation results and compare the panel estimates with the cross-sectional estimates, discussing the advantages and limitations of each approach.
Lastly, we will critically evaluate the panel estimation findings, considering potential biases, inconsistencies, or limitations in the methodology.

### Panel Estimation Task

```{r}
#| echo: false
# Define panal data frame
# Converting our data to a panel data frame
pdata <- pdata.frame(main_data_nuts2, index = c("id_nuts0", "id_nuts2", "year") )
# panel dimensions:
pdim(pdata)
```

An unbalanced panel means that not all entities are observed in each time period.
Some entities might have missing observations for certain years.
This is in contrast to a balanced panel where all entities are observed in every time period.

Overall, the code is creating a panel data frame and providing information about its dimensions.
The unbalanced panel nature is indicative of missing observations for some entities in certain years.

#### Pooling Cross Sections across time

This model is estimating the relationship between the dependent variable **`gini_n2`** (regional inequality) and the independent variable **`gdp_per_capita_n2`** (regional development) while pooling cross-sections across time.

```{r}
#| echo: false
# Pooling Cross Sections across time model
model_pooling <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "pooling")

huxreg(
  list("Pooling Model" = model_pooling),
  statistics = c(N = "nobs", R2 = "r.squared"),
  coefs = c(GDP_per_capita = "gdp_per_capita_n2", Constant = "(Intercept)"),
  stars = c(`***` = 0.01, `**` = 0.05, `*` = 0.10)
)
```

The results suggest that there is a statistically significant relationship between GDP per capita and regional inequality (**`gini_n2`**).
The positive coefficient for **`GDP_per_capita`** indicates that higher GDP per capita is associated with higher regional inequality.
The model explains approximately 38.7% of the variation in regional inequality, and both the GDP per capita coefficient and the intercept are statistically significant.

#### **Panel Estimation with Different Fixed Effects**

Model with Country Fixed Effects:

```{r}
#| echo: false
model_fe_country <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "within", effect = "individual")
summary(model_fe_country)

```

Model with Year Fixed Effects:

```{r}
#| echo: false
model_fe_year <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "within", effect = "time")
summary(model_fe_year)

```

Model with NUTS 2 Level Fixed Effects:

```{r}
#| echo: false
model_fe_nuts2 <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "within", effect = "twoways")
summary(model_fe_nuts2)
model_fe_nuts2 <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "within", effect = "twoways")
summary(model_fe_nuts2)

```

Model with Both Country and Year Fixed Effects:

```{r}
#| echo: false 
model_fe_both <- plm(gini_n2 ~ gdp_per_capita_n2, data = pdata, model = "within", effect = "twoways", index = c("id_nuts0", "year"))
summary(model_fe_both)

```

### Panel Estimation Analysis

1.  **Individual Fixed Effects (`model_fe_country`):**

    -   **Estimate:** The coefficient for **`gdp_per_capita_n2`** is 2.6176.
        This implies that, on average, a one-unit increase in **`gdp_per_capita_n2`** is associated with an increase of 2.6176 units in **`gini_n2`**.

    -   **Statistical Significance:** The coefficient is highly statistically significant (p-value \< 2.2e-16), indicating a strong relationship.

    -   **R-Squared:** The model explains about 44.1% of the variation in **`gini_n2`**.

    -   **Fixed Effect Interpretation:** The "Oneway (individual) effect Within Model" indicates that the analysis controls for individual-specific effects (country-specific effects) by subtracting the individual means from the variables.
        Therefore, the estimate represents the relationship within each country after accounting for country-specific characteristics.

2.  **Time Fixed Effects (`model_fe_year`):**

    -   **Estimate:** The coefficient for **`gdp_per_capita_n2`** is 0.0759.
        This implies that, on average, a one-unit increase in **`gdp_per_capita_n2`** is associated with an increase of 0.0759 units in **`gini_n2`**.

    -   **Statistical Significance:** The coefficient is not statistically significant at conventional levels (p-value = 0.09589).

    -   **R-Squared:** The model explains a very small proportion (about 0.19%) of the variation in **`gini_n2`**.

    -   **Fixed Effect Interpretation:** The "Oneway (time) effect Within Model" indicates that the analysis controls for time-specific effects by subtracting the time means from the variables.
        Therefore, the estimate represents the relationship within each time period after accounting for time-specific characteristics.

3.  **Two-Way Fixed Effects (`model_fe_nuts2` and `model_fe_both`):**

    -   **Estimate:** The coefficient for **`gdp_per_capita_n2`** is 0.0759.
        This implies that, on average, a one-unit increase in **`gdp_per_capita_n2`** is associated with an increase of 0.0759 units in **`gini_n2`**.

    -   **Statistical Significance:** The coefficient is not statistically significant at conventional levels (p-value = 0.09624).

    -   **R-Squared:** The model explains a very small proportion (about 0.19%) of the variation in **`gini_n2`**.

    -   **Fixed Effect Interpretation:** The "Twoways effects Within Model" indicates that the analysis controls for both individual (country) and time effects.
        The estimate represents the relationship within each country and time period after accounting for country and time-specific characteristics.

**Panel Estimation vs. Cross-Sectional Estimation: A Comparative Analysis**

In exploring the comparative aspects of panel and cross-sectional estimation, the following insights emerge.

**Panel Estimation:**

In the realm of panel estimation, individual fixed effects, denoted by model_fe_country, reveal a substantial estimate of 2.6176.
This bears high statistical significance, as indicated by a p-value less than 2.2e-16.
The model boasts an R-squared of 44.1%, suggesting a robust fit.
A distinctive feature is its capacity to control for individual-specific effects, delineating country-specific nuances.

The incorporation of time fixed effects (model_fe_year) and two-way fixed effects (model_fe_nuts2 and model_fe_both) introduces estimates of 0.0759, both lacking statistical significance at conventional levels (p-values = 0.09589 and 0.09624, respectively).
While these models control for time-specific and both individual and time effects, the non-significant coefficients hint at potential variations in the relationship over time.

**Cross-Sectional Estimation:**

Shifting to cross-sectional estimation, the model unveils a noteworthy GDP_per_capita coefficient of 2.306, marked by significance at the 0.01 level.
The intercept, standing at 0.022, is also statistically significant.
With 1532 observations, the cross-sectional model attains an R-squared of 38.7%.

**Comparative Analysis:**

**Advantages of Panel Estimation:**

-   **Control for Individual and Time Effects:**
    Panel estimation, fortified by fixed effects, adeptly manages both individual (country) and time-specific effects concurrently, enhancing the model's robustness.

-   **Enhanced R-Squared:**
    Panel models, particularly those with individual fixed effects, exhibit superior R-squared values, underscoring a better fit compared to cross-sectional models.

**Limitations of Panel Estimation:**

-   **Non-significant Time Effects:**
    Time fixed effects and two-way fixed effects models showcase non-significant coefficients for GDP_per_capita, hinting at potential variations in the relationship over time.

-   **Large Number of Observations:**
    Unbalanced panels, characterized by a substantial number of observations, may introduce computational challenges and potential convergence issues.

**Advantages of Cross-Sectional Estimation:**

-   **Simplicity:**
    Cross-sectional models, in their simplicity, offer computational ease and straightforward interpretation, making them accessible for implementation.

-   **Significant Coefficients:**
    The cross-sectional model manifests significant coefficients for GDP_per_capita and the intercept, signifying a clear relationship.

**Limitations of Cross-Sectional Estimation:**

-   **Omitted Variable Bias:**
    Cross-sectional models are susceptible to omitted variable bias, lacking control for individual or time-specific effects.

-   **Static Relationship:**
    Assuming a static relationship, cross-sectional models overlook potential variations across time and individual units.**Panel Estimation vs. Cross-Sectional Estimation: A Comparative Analysis**

    In exploring the comparative aspects of panel and cross-sectional estimation, the following insights emerge.

    **Panel Estimation:**

    In the realm of panel estimation, individual fixed effects, denoted by model_fe_country, reveal a substantial estimate of 2.6176.
    This bears high statistical significance, as indicated by a p-value less than 2.2e-16.
    The model boasts an R-squared of 44.1%, suggesting a robust fit.
    A distinctive feature is its capacity to control for individual-specific effects, delineating country-specific nuances.

    The incorporation of time fixed effects (model_fe_year) and two-way fixed effects (model_fe_nuts2 and model_fe_both) introduces estimates of 0.0759, both lacking statistical significance at conventional levels (p-values = 0.09589 and 0.09624, respectively).
    While these models control for time-specific and both individual and time effects, the non-significant coefficients hint at potential variations in the relationship over time.

    **Cross-Sectional Estimation:**

    Shifting to cross-sectional estimation, the model unveils a noteworthy GDP_per_capita coefficient of 2.306, marked by significance at the 0.01 level.
    The intercept, standing at 0.022, is also statistically significant.
    With 1532 observations, the cross-sectional model attains an R-squared of 38.7%.

    **Comparative Analysis:**

    **Advantages of Panel Estimation:**

    -   **Control for Individual and Time Effects:**
        Panel estimation, fortified by fixed effects, adeptly manages both individual (country) and time-specific effects concurrently, enhancing the model's robustness.

    -   **Enhanced R-Squared:**
        Panel models, particularly those with individual fixed effects, exhibit superior R-squared values, underscoring a better fit compared to cross-sectional models.

    **Limitations of Panel Estimation:**

    -   **Non-significant Time Effects:**
        Time fixed effects and two-way fixed effects models showcase non-significant coefficients for GDP_per_capita, hinting at potential variations in the relationship over time.

    -   **Large Number of Observations:**
        Unbalanced panels, characterized by a substantial number of observations, may introduce computational challenges and potential convergence issues.

    **Advantages of Cross-Sectional Estimation:**

    -   **Simplicity:**
        Cross-sectional models, in their simplicity, offer computational ease and straightforward interpretation, making them accessible for implementation.

    -   **Significant Coefficients:**
        The cross-sectional model manifests significant coefficients for GDP_per_capita and the intercept, signifying a clear relationship.

    **Limitations of Cross-Sectional Estimation:**

    -   **Omitted Variable Bias:**
        Cross-sectional models are susceptible to omitted variable bias, lacking control for individual or time-specific effects.

    -   **Static Relationship:**
        Assuming a static relationship, cross-sectional models overlook potential variations across time and individual units.

### Panel Estimation Discussion

The panel estimation findings shed light on the intricate relationship between GDP per capita (gdp_per_capita_n2) and regional inequality (gini_n2) under various fixed effects models.
While these results offer valuable insights, it is crucial to critically evaluate them, considering potential biases, inconsistencies, and limitations in the methodology.

**Individual Fixed Effects (model_fe_country):**

The estimate of 2.6176 reveals a significant positive association between GDP per capita and regional inequality.
However, the robustness of this relationship is contingent upon the assumption that individual-specific effects are adequately captured.
Despite the high statistical significance and a commendable R-squared of 44.1%, it is imperative to acknowledge that unobserved individual factors might still introduce bias.

**Time Fixed Effects (model_fe_year):**

The modest estimate of 0.0759, coupled with a lack of statistical significance at conventional levels, raises concerns about the reliability of the relationship over time.
The minimal explanatory power (0.19%) suggests that time-specific effects, as controlled by the model, contribute only marginally to the overall understanding of regional inequality dynamics.

**Two-Way Fixed Effects (model_fe_nuts2 and model_fe_both):**

While the two-way fixed effects attempt to simultaneously control for individual and time effects, the consistent estimate of 0.0759, coupled with non-significance, prompts a critical examination.
The limited explanatory power (0.19%) indicates that, even with the inclusion of both sets of fixed effects, a substantial proportion of the variation in regional inequality remains unexplained.

In light of these critical evaluations, it is crucial to recognize the overarching limitations of panel estimation.
The assumption that fixed effects adequately capture all relevant individual and time-specific factors might be optimistic.
Unobserved heterogeneity, unaccounted for in the models, could introduce biases, potentially leading to an overestimation or underestimation of the true relationship.

Moreover, the reliance on a large number of observations in unbalanced panels may introduce computational challenges and convergence issues.
The potential for omitted variable bias, even within the comprehensive fixed effects framework, warrants careful consideration.The panel estimation findings shed light on the intricate relationship between GDP per capita (gdp_per_capita_n2) and regional inequality (gini_n2) under various fixed effects models.
While these results offer valuable insights, it is crucial to critically evaluate them, considering potential biases, inconsistencies, and limitations in the methodology.

**Individual Fixed Effects (model_fe_country):**

The estimate of 2.6176 reveals a significant positive association between GDP per capita and regional inequality.
However, the robustness of this relationship is contingent upon the assumption that individual-specific effects are adequately captured.
Despite the high statistical significance and a commendable R-squared of 44.1%, it is imperative to acknowledge that unobserved individual factors might still introduce bias.

**Time Fixed Effects (model_fe_year):**

The modest estimate of 0.0759, coupled with a lack of statistical significance at conventional levels, raises concerns about the reliability of the relationship over time.
The minimal explanatory power (0.19%) suggests that time-specific effects, as controlled by the model, contribute only marginally to the overall understanding of regional inequality dynamics.

**Two-Way Fixed Effects (model_fe_nuts2 and model_fe_both):**

While the two-way fixed effects attempt to simultaneously control for individual and time effects, the consistent estimate of 0.0759, coupled with non-significance, prompts a critical examination.
The limited explanatory power (0.19%) indicates that, even with the inclusion of both sets of fixed effects, a substantial proportion of the variation in regional inequality remains unexplained.

In light of these critical evaluations, it is crucial to recognize the overarching limitations of panel estimation.
The assumption that fixed effects adequately capture all relevant individual and time-specific factors might be optimistic.
Unobserved heterogeneity, unaccounted for in the models, could introduce biases, potentially leading to an overestimation or underestimation of the true relationship.

Moreover, the reliance on a large number of observations in unbalanced panels may introduce computational challenges and convergence issues.
The potential for omitted variable bias, even within the comprehensive fixed effects framework, warrants careful consideration.

# References
